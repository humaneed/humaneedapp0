<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
  <meta name="theme-color" content="#1A1A1A">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>Humaneed</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
:root{
  --s1:6px;--s2:12px;--s3:16px;--s4:24px;
  --r:10px;--r2:8px;--r3:6px;
  
  --bg:#121212;
  --bg2:#1E1E1E;
  --card:#252525;
  --cardHover:#2A2A2A;
  
  --text:#FFFFFF;
  --sub:#B0B0B0;
  --muted:#707070;
  --faint:#505050;
  
  --line:rgba(255,255,255,.1);
  --line2:rgba(255,255,255,.05);
  
  --accent:#E8A838;
  
  --good:#4CAF50;
  --warn:#FFA726;
  --bad:#EF5350;
  
  --t-foundation:#4CAF50;
  --t-safety:#29B6F6;
  --t-connect:#AB47BC;
  --t-esteem:#FFA726;
  --t-self:#EC407A;
  --t-trans:#F06292;
  
  --shadow:0 2px 12px rgba(0,0,0,.4);
  --ease:cubic-bezier(.22,1,.36,1);
  --fast:100ms;
}

@media(prefers-color-scheme:light){:root{
  --bg:#F5F5F5;
  --bg2:#EBEBEB;
  --card:#FFFFFF;
  --cardHover:#FAFAFA;
  --text:#1A1A1A;
  --sub:#555555;
  --muted:#888888;
  --faint:#AAAAAA;
  --line:rgba(0,0,0,.08);
  --line2:rgba(0,0,0,.04);
  --shadow:0 2px 12px rgba(0,0,0,.1);
}}

*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}

body{
  font-family:'Inter',system-ui,sans-serif;
  background:var(--bg);
  color:var(--sub);
  min-height:100dvh;
  display:flex;
  justify-content:center;
  -webkit-font-smoothing:antialiased;
}

#app{
  width:100%;
  max-width:420px;
  min-height:100dvh;
  display:flex;
  flex-direction:column;
  background:var(--bg);
}

/* ===== HEADER ===== */
header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:12px 16px;
  background:var(--bg2);
  border-bottom:1px solid var(--line);
}
.logo{font-size:15px;font-weight:700;color:var(--text)}
.logo span{color:var(--accent)}
.hdr-r{display:flex;gap:6px;align-items:center}
.hdr-pill{
  padding:6px 10px;
  background:var(--card);
  border-radius:var(--r3);
  font-size:11px;
  font-weight:600;
  color:var(--sub);
  cursor:pointer;
  display:flex;
  align-items:center;
  gap:4px;
}
.hdr-pill:hover{background:var(--cardHover)}
.hdr-score{
  background:var(--accent);
  color:var(--bg);
  font-weight:700;
  min-width:36px;
  text-align:center;
}

/* ===== MAIN CONTENT ===== */
main{
  flex:1;
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

/* ===== MOOD BAR (always visible) ===== */
.mood-bar{
  display:flex;
  justify-content:center;
  gap:10px;
  padding:14px 16px;
  background:var(--bg2);
  border-bottom:1px solid var(--line);
}
.mood-btn{
  width:40px;
  height:40px;
  border-radius:50%;
  border:none;
  cursor:pointer;
  transition:all var(--fast) var(--ease);
  box-shadow:0 2px 6px rgba(0,0,0,.3),inset 0 1px 2px rgba(255,255,255,.2);
}
.mood-btn[data-m="1"]{background:linear-gradient(180deg,#EF5350,#C62828)}
.mood-btn[data-m="2"]{background:linear-gradient(180deg,#FFA726,#EF6C00)}
.mood-btn[data-m="3"]{background:linear-gradient(180deg,#FFCA28,#F9A825)}
.mood-btn[data-m="4"]{background:linear-gradient(180deg,#9CCC65,#7CB342)}
.mood-btn[data-m="5"]{background:linear-gradient(180deg,#66BB6A,#43A047)}
.mood-btn:hover{transform:scale(1.1)}
.mood-btn.on{
  transform:translateY(2px);
  box-shadow:0 1px 2px rgba(0,0,0,.2),inset 0 2px 6px rgba(0,0,0,.4);
}

/* ===== TAB CONTENT ===== */
.tab-content{
  flex:1;
  overflow-y:auto;
  padding:var(--s3);
  padding-bottom:70px;
}

.view{display:none}
.view.on{display:block;animation:fadeIn .15s ease}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}

/* ===== TIERS GRID ===== */
.tiers{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:8px;
  margin-bottom:var(--s3);
}
.tier{
  background:var(--card);
  border-radius:var(--r2);
  padding:10px 12px;
  cursor:pointer;
  transition:all var(--fast) var(--ease);
  border:1px solid var(--line);
}
.tier:hover{background:var(--cardHover);border-color:var(--accent)}
.tier.focus{border-color:var(--accent);border-width:2px}
.tier-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px}
.tier-name{font-size:11px;font-weight:600;color:var(--text)}
.tier-val{font-size:13px;font-weight:700}
.tier-bar{height:4px;background:var(--bg);border-radius:2px;overflow:hidden}
.tier-fill{height:100%;border-radius:2px;transition:width .3s ease}
.tier-icon{width:18px;height:18px}
.tier-icon svg{width:100%;height:100%;fill:none;stroke:currentColor;stroke-width:2;stroke-linecap:round;stroke-linejoin:round}

/* ===== ACTION CARD ===== */
.action-card{
  background:var(--card);
  border-radius:var(--r);
  padding:var(--s3);
  margin-bottom:var(--s3);
  border:1px solid var(--line);
}
.action-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:8px;
}
.action-tag{
  font-size:9px;
  font-weight:700;
  text-transform:uppercase;
  letter-spacing:.5px;
  color:var(--accent);
  display:flex;
  align-items:center;
  gap:4px;
}
.action-counter{font-size:10px;color:var(--muted)}
.action-text{font-size:15px;font-weight:600;color:var(--text);line-height:1.4;margin-bottom:12px}
.action-flavor{
  font-size:11px;
  color:var(--muted);
  font-style:italic;
  margin-bottom:12px;
  padding:8px 10px;
  background:var(--bg);
  border-radius:var(--r3);
  display:none;
}
.action-flavor.show{display:block}
.action-btns{display:flex;gap:6px}
.action-btns button{
  flex:1;
  padding:10px;
  border:none;
  border-radius:var(--r3);
  font:inherit;
  font-size:11px;
  font-weight:600;
  cursor:pointer;
  transition:all var(--fast) var(--ease);
  background:var(--bg);
  color:var(--sub);
}
.action-btns button:hover{background:var(--bg2)}
.action-btns .primary{background:var(--accent);color:var(--bg)}
.action-btns .primary:hover{filter:brightness(1.1)}

.action-explain{
  display:none;
  background:var(--bg);
  border-radius:var(--r3);
  padding:10px 12px;
  margin-bottom:12px;
  font-size:11px;
  line-height:1.5;
}
.action-explain.show{display:block}
.action-explain-row{
  display:flex;
  gap:8px;
  margin-bottom:6px;
}
.action-explain-row:last-child{margin-bottom:0}
.action-explain-label{
  font-size:9px;
  font-weight:700;
  text-transform:uppercase;
  color:var(--muted);
  min-width:50px;
}
.action-explain-text{color:var(--sub)}

/* ===== PLAN LIST ===== */
.plan-list{margin-bottom:var(--s3)}
.plan-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:8px;
}
.plan-title{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;color:var(--muted)}
.plan-action{font-size:10px;color:var(--accent);cursor:pointer}
.plan-items{display:flex;flex-direction:column;gap:4px}
.plan-item{
  display:flex;
  align-items:center;
  gap:10px;
  padding:10px 12px;
  background:var(--card);
  border-radius:var(--r3);
  cursor:pointer;
  transition:all var(--fast) var(--ease);
  border:1px solid transparent;
}
.plan-item:hover{background:var(--cardHover)}
.plan-item.active{border-color:var(--accent)}
.plan-item.done{opacity:.5}
.plan-check{
  width:18px;
  height:18px;
  border-radius:50%;
  border:2px solid var(--line);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:10px;
  color:transparent;
  flex-shrink:0;
}
.plan-item.done .plan-check{background:var(--good);border-color:var(--good);color:#fff}
.plan-item-text{font-size:12px;color:var(--text);flex:1}
.plan-item.done .plan-item-text{text-decoration:line-through;color:var(--muted)}

/* ===== CHIPS ===== */
.chips-section{margin-bottom:var(--s3)}
.chips-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:8px;
}
.chips-title{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;color:var(--muted)}
.chips-toggle{font-size:10px;color:var(--accent);cursor:pointer}
.chips{display:flex;flex-wrap:wrap;gap:4px}
.chip{
  padding:6px 10px;
  background:var(--card);
  border-radius:var(--r3);
  font-size:10px;
  color:var(--sub);
  cursor:pointer;
  transition:all var(--fast) var(--ease);
  border:1px solid transparent;
}
.chip:hover{background:var(--cardHover)}
.chip.on{background:rgba(76,175,80,.15);border-color:var(--good);color:var(--good)}
.chip.bad.on{background:rgba(239,83,80,.15);border-color:var(--bad);color:var(--bad)}

/* ===== SCORE VIEW ===== */
.score-hero{
  text-align:center;
  padding:var(--s4) 0;
  margin-bottom:var(--s3);
}
.score-num{font-size:64px;font-weight:700;color:var(--text);line-height:1}
.score-label{font-size:12px;font-weight:600;color:var(--accent);margin-top:4px}
.score-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;margin-bottom:var(--s3)}
.score-item{
  background:var(--card);
  border-radius:var(--r3);
  padding:12px 8px;
  text-align:center;
}
.score-item-val{font-size:18px;font-weight:700}
.score-item-label{font-size:8px;font-weight:600;text-transform:uppercase;letter-spacing:.3px;color:var(--muted);margin-top:2px}

/* ===== JOURNAL VIEW ===== */
.insight{
  background:var(--card);
  border-radius:var(--r3);
  padding:10px 12px;
  font-size:11px;
  color:var(--sub);
  margin-bottom:6px;
  line-height:1.4;
}
.journal-list{display:flex;flex-direction:column;gap:6px}
.journal-day{
  background:var(--card);
  border-radius:var(--r3);
  padding:10px 12px;
}
.journal-day-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px}
.journal-date{font-size:11px;font-weight:600;color:var(--text)}
.journal-meta{display:flex;align-items:center;gap:8px}
.journal-mood{width:10px;height:10px;border-radius:50%}
.journal-score{font-size:12px;font-weight:700;color:var(--accent)}
.journal-summary{font-size:10px;color:var(--muted)}
.journal-tags{display:flex;flex-wrap:wrap;gap:3px;margin-top:4px}
.tag{padding:2px 6px;border-radius:4px;font-size:8px;font-weight:600}
.tag.g{background:rgba(76,175,80,.15);color:var(--good)}
.tag.b{background:rgba(239,83,80,.15);color:var(--bad)}

/* ===== BOTTOM NAV ===== */
nav{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  display:flex;
  justify-content:center;
  padding:8px 16px calc(8px + env(safe-area-inset-bottom));
  background:var(--bg2);
  border-top:1px solid var(--line);
}
.nav-inner{
  display:flex;
  gap:4px;
  background:var(--card);
  padding:4px;
  border-radius:var(--r);
  width:100%;
  max-width:300px;
}
nav button{
  flex:1;
  padding:10px;
  border:none;
  border-radius:var(--r3);
  background:transparent;
  font:inherit;
  font-size:10px;
  font-weight:600;
  color:var(--muted);
  cursor:pointer;
  transition:all var(--fast) var(--ease);
}
nav button:hover{color:var(--text)}
nav button.on{background:var(--accent);color:var(--bg)}

/* ===== MODAL ===== */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:flex-end;
  justify-content:center;
  z-index:100;
}
.modal.show{display:flex}
.modal-box{
  background:var(--bg);
  border-radius:var(--r) var(--r) 0 0;
  padding:var(--s3);
  width:100%;
  max-width:420px;
  max-height:60vh;
  overflow-y:auto;
}
.modal-title{font-size:13px;font-weight:700;color:var(--text);text-align:center;margin-bottom:var(--s3)}
.arch-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:6px}
.arch-opt{
  padding:10px 6px;
  background:var(--card);
  border-radius:var(--r3);
  text-align:center;
  cursor:pointer;
  transition:all var(--fast) var(--ease);
  border:2px solid transparent;
}
.arch-opt:hover{background:var(--cardHover)}
.arch-opt.on{border-color:var(--accent)}
.arch-opt-icon{margin-bottom:4px}
.arch-opt-name{font-size:9px;font-weight:600;color:var(--text)}
.modal-close{
  width:100%;
  padding:12px;
  margin-top:var(--s3);
  border:none;
  border-radius:var(--r3);
  background:var(--card);
  font:inherit;
  font-size:11px;
  font-weight:600;
  color:var(--text);
  cursor:pointer;
}

.toast{
  position:fixed;
  bottom:75px;
  left:50%;
  transform:translateX(-50%) translateY(10px);
  background:var(--card);
  border:1px solid var(--accent);
  padding:8px 16px;
  border-radius:var(--r);
  font-size:11px;
  font-weight:600;
  color:var(--text);
  opacity:0;
  pointer-events:none;
  transition:all .2s;
  z-index:50;
}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

.blocker{
  background:rgba(239,83,80,.1);
  border:1px solid var(--bad);
  border-radius:var(--r3);
  padding:10px 12px;
  margin-bottom:var(--s3);
  font-size:11px;
}
.blocker-title{font-weight:700;color:var(--bad);margin-bottom:2px}
.blocker-msg{color:var(--sub)}

.icon{display:inline-flex;align-items:center;justify-content:center}
.icon svg{width:100%;height:100%;fill:none;stroke:currentColor;stroke-width:2;stroke-linecap:round;stroke-linejoin:round}
.icon-sm{width:14px;height:14px}
.icon-md{width:18px;height:18px}
.icon-lg{width:24px;height:24px}

.section-title{
  font-size:10px;
  font-weight:700;
  text-transform:uppercase;
  letter-spacing:.5px;
  color:var(--muted);
  margin-bottom:8px;
}
  </style>
</head>
<body>
<div id="app">
  <header>
    <div class="logo">Human<span>eed</span></div>
    <div class="hdr-r">
      <div class="hdr-pill" id="hdrArch"></div>
      <div class="hdr-pill hdr-score" id="hdrScore">—</div>
    </div>
  </header>
  
  <main>
    <div class="mood-bar" id="moodBar"></div>
    
    <div class="tab-content">
      <!-- TODAY -->
      <div class="view on" id="v-today">
        <div class="blocker" id="blocker" style="display:none"></div>
        
        <div class="tiers" id="tiers"></div>
        
        <div class="action-card" id="actionCard">
          <div class="action-header">
            <div class="action-tag" id="actionTag"></div>
            <div class="action-counter" id="actionCounter"></div>
          </div>
          <div class="action-text" id="actionText">Wähle deine Stimmung</div>
          <div class="action-explain" id="actionExplain"></div>
          <div class="action-btns">
            <button id="btnWhy">Warum?</button>
            <button id="btnSkip">Weiter</button>
            <button class="primary" id="btnDone">Erledigt ✓</button>
          </div>
        </div>
        
        <div class="plan-list" id="planSection">
          <div class="plan-header">
            <div class="plan-title">Perspektiven</div>
            <div class="plan-action" id="regenPlan">Neu</div>
          </div>
          <div class="plan-items" id="planItems"></div>
        </div>
        
        <div class="chips-section">
          <div class="chips-header">
            <div class="chips-title">Positiv</div>
            <div class="chips-toggle" id="togG">+</div>
          </div>
          <div class="chips" id="goodChips"></div>
        </div>
        
        <div class="chips-section">
          <div class="chips-header">
            <div class="chips-title">Negativ</div>
            <div class="chips-toggle" id="togB">+</div>
          </div>
          <div class="chips" id="badChips"></div>
        </div>
      </div>
      
      <!-- SCORE -->
      <div class="view" id="v-score">
        <div class="score-hero">
          <div class="score-num" id="scoreVal">—</div>
          <div class="score-label" id="scoreBadge">Startklar</div>
        </div>
        <div class="score-grid">
          <div class="score-item"><div class="score-item-val" id="vBase" style="color:var(--t-foundation)">—</div><div class="score-item-label">Basis</div></div>
          <div class="score-item"><div class="score-item-val" id="vSafe" style="color:var(--t-safety)">—</div><div class="score-item-label">Sicherheit</div></div>
          <div class="score-item"><div class="score-item-val" id="vConn" style="color:var(--t-connect)">—</div><div class="score-item-label">Verbindung</div></div>
        </div>
        <div class="score-grid">
          <div class="score-item"><div class="score-item-val" id="vEsteem" style="color:var(--t-esteem)">—</div><div class="score-item-label">Selbstwert</div></div>
          <div class="score-item"><div class="score-item-val" id="vSelf" style="color:var(--t-self)">—</div><div class="score-item-label">Wachstum</div></div>
          <div class="score-item"><div class="score-item-val" id="vTrans" style="color:var(--t-trans)">—</div><div class="score-item-label">Beitrag</div></div>
        </div>
        <div class="section-title" style="margin-top:16px">Empfehlungen</div>
        <div id="recs"></div>
      </div>
      
      <!-- JOURNAL -->
      <div class="view" id="v-journal">
        <div class="section-title">Erkenntnisse</div>
        <div id="insights"></div>
        <div class="section-title" style="margin-top:16px">Verlauf</div>
        <div class="journal-list" id="journal"></div>
      </div>
    </div>
  </main>
  
  <nav>
    <div class="nav-inner">
      <button class="on" data-v="today">Heute</button>
      <button data-v="score">Score</button>
      <button data-v="journal">Verlauf</button>
    </div>
  </nav>
  
  <div class="toast" id="toast"></div>
  
  <div class="modal" id="modal">
    <div class="modal-box">
      <div class="modal-title">Archetyp wählen</div>
      <div class="arch-grid" id="archGrid"></div>
      <button class="modal-close" id="closeModal">Fertig</button>
    </div>
  </div>
</div>

<script>
(function(){
const $=s=>document.querySelector(s),$$=s=>[...document.querySelectorAll(s)];
const today=()=>new Date().toISOString().slice(0,10);
const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
const uid=()=>Math.random().toString(36).slice(2,9);

// SVG Icons
const ICONS={
  foundation:'<svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>',
  safety:'<svg viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>',
  connect:'<svg viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>',
  esteem:'<svg viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>',
  self:'<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>',
  trans:'<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>',
  stoiker:'<svg viewBox="0 0 24 24"><path d="M3 21h18"/><path d="M5 21V7l7-4 7 4v14"/></svg>',
  athlet:'<svg viewBox="0 0 24 24"><circle cx="12" cy="5" r="3"/><path d="M12 8v8M8 21l4-5 4 5"/></svg>',
  minimalist:'<svg viewBox="0 0 24 24"><rect x="4" y="4" width="16" height="16" rx="2"/></svg>',
  macher:'<svg viewBox="0 0 24 24"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>',
  verbinder:'<svg viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78L12 21.23l8.84-8.84a5.5 5.5 0 0 0 0-7.78z"/></svg>',
  kreativ:'<svg viewBox="0 0 24 24"><path d="M12 19l7-7 3 3-7 7-3-3z"/><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/></svg>',
  forscher:'<svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>',
  heiler:'<svg viewBox="0 0 24 24"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>',
  stratege:'<svg viewBox="0 0 24 24"><polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"/></svg>',
  mentor:'<svg viewBox="0 0 24 24"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>',
  abenteurer:'<svg viewBox="0 0 24 24"><polygon points="3 11 22 2 13 21 11 13 3 11"/></svg>',
  philosoph:'<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>',
  handwerker:'<svg viewBox="0 0 24 24"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>'
};

const icon=(name,cls='')=>`<span class="icon ${cls}">${ICONS[name]||''}</span>`;

const MOOD_N=['Schlecht','Mäßig','Okay','Gut','Super'];

const TIERS=[
  {k:'foundation',n:'Basis',c:'--t-foundation'},
  {k:'safety',n:'Sicherheit',c:'--t-safety'},
  {k:'connect',n:'Verbindung',c:'--t-connect'},
  {k:'esteem',n:'Selbstwert',c:'--t-esteem'},
  {k:'self',n:'Wachstum',c:'--t-self'},
  {k:'trans',n:'Beitrag',c:'--t-trans'}
];

const GOOD=[
  {k:'sleep',l:'Gut geschlafen',t:'foundation'},{k:'move',l:'Bewegt',t:'foundation'},{k:'eat',l:'Gesund gegessen',t:'foundation'},{k:'water',l:'Getrunken',t:'foundation'},
  {k:'plan',l:'Geplant',t:'safety'},{k:'tidy',l:'Aufgeräumt',t:'safety'},{k:'focus',l:'Fokussiert',t:'safety'},
  {k:'contact',l:'Kontakt',t:'connect'},{k:'thanks',l:'Dankbar',t:'connect'},{k:'helped',l:'Geholfen',t:'connect'},
  {k:'skill',l:'Gelernt',t:'esteem'},{k:'finished',l:'Erledigt',t:'esteem'},{k:'courage',l:'Mut',t:'esteem'},
  {k:'deep',l:'Deep Work',t:'self'},{k:'create',l:'Erschaffen',t:'self'},
  {k:'value',l:'Wert gegeben',t:'trans'},{k:'inspire',l:'Inspiriert',t:'trans'}
];

const BAD=[
  {k:'tired',l:'Erschöpft',t:'foundation'},{k:'bad_sleep',l:'Schlecht geschlafen',t:'foundation'},{k:'no_move',l:'Nicht bewegt',t:'foundation'},
  {k:'chaos',l:'Chaos',t:'safety'},{k:'scroll',l:'Viel gescrollt',t:'safety'},{k:'overwhelm',l:'Überfordert',t:'safety'},
  {k:'alone',l:'Einsam',t:'connect'},{k:'conflict',l:'Konflikt',t:'connect'},
  {k:'procrastinate',l:'Aufgeschoben',t:'esteem'},{k:'stuck',l:'Blockiert',t:'esteem'},
  {k:'no_progress',l:'Kein Fortschritt',t:'self'},{k:'meaningless',l:'Sinnlos',t:'trans'}
];

const ARCH={
  stoiker:{n:'Stoiker',e:'stoiker',tier:'safety'},
  athlet:{n:'Athlet',e:'athlet',tier:'foundation'},
  minimalist:{n:'Minimalist',e:'minimalist',tier:'safety'},
  macher:{n:'Macher',e:'macher',tier:'esteem'},
  verbinder:{n:'Verbinder',e:'verbinder',tier:'connect'},
  kreativ:{n:'Künstler',e:'kreativ',tier:'self'},
  forscher:{n:'Forscher',e:'forscher',tier:'self'},
  heiler:{n:'Heiler',e:'heiler',tier:'foundation'},
  stratege:{n:'Stratege',e:'stratege',tier:'safety'},
  mentor:{n:'Mentor',e:'mentor',tier:'trans'},
  abenteurer:{n:'Abenteurer',e:'abenteurer',tier:'self'},
  philosoph:{n:'Philosoph',e:'philosoph',tier:'self'},
  handwerker:{n:'Handwerker',e:'handwerker',tier:'esteem'}
};
const ARCH_ORDER=Object.keys(ARCH);

// Actions with explanations
const ACTIONS={
  foundation:{
    hi:[
      {t:'30 Min Bewegung',why:'Bewegung setzt Endorphine frei und verbessert Fokus.',how:'Spazieren, Joggen, oder Workout.',min:'10 Min reichen auch.'},
      {t:'Gesunde Mahlzeit',why:'Nährstoffe beeinflussen Energie und Stimmung direkt.',how:'Gemüse, Protein, wenig Zucker.',min:'Eine gesunde Zutat hinzufügen.'},
      {t:'8h Schlaf planen',why:'Schlaf ist das Fundament für alles andere.',how:'Wecker rückwärts rechnen, Bildschirme weg.',min:'30 Min früher ins Bett.'},
      {t:'Spaziergang draußen',why:'Tageslicht reguliert den Schlafrhythmus.',how:'15-30 Min ohne Handy.',min:'5 Min vor die Tür.'},
      {t:'Stretching-Routine',why:'Löst Verspannungen und verbessert Durchblutung.',how:'5-10 Min dehnen.',min:'3 tiefe Atemzüge mit Stretch.'}
    ],
    lo:[
      {t:'5 Min Bewegung',why:'Selbst kurze Bewegung aktiviert den Körper.',how:'Kniebeugen, Arme kreisen.',min:'Einmal aufstehen und strecken.'},
      {t:'Glas Wasser trinken',why:'Dehydration verstärkt Müdigkeit.',how:'Großes Glas, langsam trinken.',min:'Ein paar Schlucke.'},
      {t:'Kurze Pause machen',why:'Das Gehirn braucht Erholung.',how:'Augen schließen, nichts tun.',min:'30 Sekunden Augen zu.'},
      {t:'Fenster öffnen',why:'Frische Luft bringt Sauerstoff.',how:'5 Min lüften.',min:'Einmal tief einatmen.'},
      {t:'3 tiefe Atemzüge',why:'Aktiviert das parasympathische Nervensystem.',how:'4 Sek ein, 7 halten, 8 aus.',min:'Ein bewusster Atemzug.'}
    ]
  },
  safety:{
    hi:[
      {t:'Woche planen',why:'Klarheit reduziert Stress.',how:'Top 3 Prioritäten pro Tag festlegen.',min:'Nur morgen planen.'},
      {t:'Aufräumen',why:'Äußere Ordnung schafft innere Ruhe.',how:'Ein Bereich komplett aufräumen.',min:'Eine Oberfläche frei machen.'},
      {t:'Finanzen checken',why:'Finanzielle Klarheit gibt Sicherheit.',how:'Kontostand, offene Rechnungen.',min:'Nur Kontostand ansehen.'},
      {t:'Digital Detox 2h',why:'Ständige Erreichbarkeit stresst.',how:'Handy in anderen Raum.',min:'30 Min ohne Handy.'},
      {t:'Prioritäten setzen',why:'Nicht alles ist gleich wichtig.',how:'Was hat heute den größten Impact?',min:'Eine Sache als wichtigste markieren.'}
    ],
    lo:[
      {t:'1 Aufgabe aufschreiben',why:'Aus dem Kopf aufs Papier entlastet.',how:'Egal welche, einfach notieren.',min:'Gedanke aussprechen.'},
      {t:'Kleines aufräumen',why:'Kleine Erfolge bauen Momentum.',how:'Schreibtisch oder eine Schublade.',min:'3 Dinge an ihren Platz.'},
      {t:'2-Minuten-Regel',why:'Schnelle Wins eliminieren mentale Last.',how:'Alles unter 2 Min sofort tun.',min:'Eine Sache sofort erledigen.'},
      {t:'Handy weglegen',why:'Aus den Augen, aus dem Sinn.',how:'In Schublade oder anderen Raum.',min:'Umdrehen reicht.'},
      {t:'Nein sagen',why:'Grenzen schützen deine Energie.',how:'Höflich aber bestimmt ablehnen.',min:'Innerlich Nein denken.'}
    ]
  },
  connect:{
    hi:[
      {t:'Freund anrufen',why:'Stimme schafft mehr Nähe als Text.',how:'10-15 Min ungestört telefonieren.',min:'Kurze Sprachnachricht.'},
      {t:'Echtes Gespräch führen',why:'Tiefe Gespräche erfüllen mehr als Small Talk.',how:'Offene Fragen stellen, zuhören.',min:'Eine ehrliche Frage stellen.'},
      {t:'Danke sagen',why:'Dankbarkeit stärkt Beziehungen.',how:'Konkret sagen wofür.',min:'Innerlich dankbar sein.'},
      {t:'Gemeinsam essen',why:'Geteilte Mahlzeiten verbinden.',how:'Mit Familie, Freund, Kollege.',min:'Jemanden fragen.'},
      {t:'Aktiv zuhören',why:'Echtes Zuhören ist selten und wertvoll.',how:'Nicht unterbrechen, nachfragen.',min:'30 Sek nur zuhören.'}
    ],
    lo:[
      {t:'Kurze Nachricht senden',why:'Zeigt dass du an jemanden denkst.',how:'Hey, wie geht es dir?',min:'Emoji schicken.'},
      {t:'Jemanden anlächeln',why:'Lächeln ist ansteckend.',how:'Bewusst anlächeln.',min:'Mundwinkel heben.'},
      {t:'Blickkontakt halten',why:'Verbindet ohne Worte.',how:'3 Sekunden halten.',min:'Kurz in die Augen schauen.'},
      {t:'An jemanden denken',why:'Positive Gedanken wirken.',how:'Jemandem Gutes wünschen.',min:'Ein Gesicht visualisieren.'},
      {t:'Kompliment machen',why:'Hebt beide Seiten.',how:'Ehrlich und spezifisch.',min:'Innerlich anerkennen.'}
    ]
  },
  esteem:{
    hi:[
      {t:'Schwieriges zuerst',why:'Willenskraft ist morgens am höchsten.',how:'Unangenehmste Aufgabe zuerst.',min:'Nur anfangen.'},
      {t:'Projekt abschließen',why:'Abschlüsse geben Erfolgsgefühl.',how:'Etwas zu 100% fertig machen.',min:'Einen Teil abschließen.'},
      {t:'Skill üben',why:'Kompetenz baut Selbstwert.',how:'30 Min fokussiert üben.',min:'5 Min üben.'},
      {t:'Feedback holen',why:'Zeigt Mut und beschleunigt Lernen.',how:'Konkret fragen was besser geht.',min:'Eine Frage stellen.'},
      {t:'Etwas präsentieren',why:'Überwindet Angst und baut Selbstvertrauen.',how:'Idee vorstellen, egal wie klein.',min:'Laut aussprechen.'}
    ],
    lo:[
      {t:'Kleinste Aufgabe',why:'Selbst winzige Erfolge zählen.',how:'Was ist das Minimum?',min:'Einen Schritt machen.'},
      {t:'5 Min anfangen',why:'Anfangen ist das Schwerste.',how:'Timer auf 5 Min, dann stoppen erlaubt.',min:'Datei öffnen.'},
      {t:'Erfolg notieren',why:'Wir vergessen unsere Erfolge zu schnell.',how:'Was hast du heute geschafft?',min:'Einen Erfolg denken.'},
      {t:'Fehler zugeben',why:'Ehrlichkeit stärkt Integrität.',how:'Ohne Ausreden.',min:'Dir selbst gegenüber.'},
      {t:'Zusage einhalten',why:'Zuverlässigkeit baut Selbstvertrauen.',how:'Tu was du gesagt hast.',min:'Eine kleine Zusage.'}
    ]
  },
  self:{
    hi:[
      {t:'Deep Work 90 Min',why:'Tiefe Arbeit bringt echten Fortschritt.',how:'Keine Ablenkungen, ein Thema.',min:'30 Min fokussiert.'},
      {t:'Etwas Neues lernen',why:'Lernen hält den Geist flexibel.',how:'Kurs, Buch, Tutorial.',min:'Einen Artikel lesen.'},
      {t:'Kreativ sein',why:'Kreativität ist ein Grundbedürfnis.',how:'Schreiben, zeichnen, bauen.',min:'Eine Idee skizzieren.'},
      {t:'Reflektieren',why:'Reflexion macht Erfahrung zu Weisheit.',how:'Journal, Meditation.',min:'Eine Frage beantworten.'},
      {t:'Lesen',why:'Lesen erweitert Perspektiven.',how:'30 Min ohne Ablenkung.',min:'Eine Seite.'}
    ],
    lo:[
      {t:'15 Min fokussiert',why:'Kurze fokussierte Zeit schlägt lange abgelenkte.',how:'Eine Sache, keine Ablenkung.',min:'5 Min.'},
      {t:'1 Artikel komplett lesen',why:'Tiefe statt Breite.',how:'Bis zum Ende, nicht überfliegen.',min:'Ersten Absatz.'},
      {t:'Idee notieren',why:'Ideen verschwinden schnell.',how:'Sofort aufschreiben.',min:'Ein Wort.'},
      {t:'5 Min meditieren',why:'Trainiert Aufmerksamkeit.',how:'Nur auf Atem achten.',min:'3 Atemzüge bewusst.'},
      {t:'Neugierig sein',why:'Neugier ist der Anfang von Wachstum.',how:'Eine Frage googlen.',min:'Frage stellen.'}
    ]
  },
  trans:{
    hi:[
      {t:'Jemandem helfen',why:'Helfen gibt Sinn und Verbindung.',how:'Aktiv anbieten.',min:'Fragen ob Hilfe nötig.'},
      {t:'Wissen teilen',why:'Geteiltes Wissen multipliziert sich.',how:'Erklären, schreiben, zeigen.',min:'Einen Tipp geben.'},
      {t:'Mentoring',why:'Andere wachsen zu sehen ist erfüllend.',how:'Zeit für jemanden nehmen.',min:'Eine Frage beantworten.'},
      {t:'Spenden',why:'Geben aktiviert Belohnungszentrum.',how:'Zeit, Geld, oder Sachen.',min:'Etwas aussortieren.'},
      {t:'Projekt für andere starten',why:'Größere Wirkung durch Systeme.',how:'Was hilft vielen?',min:'Idee notieren.'}
    ],
    lo:[
      {t:'Tür aufhalten',why:'Kleine Gesten zählen.',how:'Aufmerksam sein.',min:'Lächeln.'},
      {t:'Jemanden ermutigen',why:'Ermutigung kann alles ändern.',how:'Du schaffst das.',min:'Nicken.'},
      {t:'Ressource teilen',why:'Was dir hilft, hilft anderen.',how:'Link, Buch, Tipp.',min:'Empfehlung merken.'},
      {t:'Wirklich zuhören',why:'Volle Aufmerksamkeit ist ein Geschenk.',how:'Ohne eigene Agenda.',min:'Nachfragen.'},
      {t:'Kleine Geste',why:'Unerwartete Freundlichkeit wirkt.',how:'Kaffee, Kompliment, Hilfe.',min:'Gedanke.'}
    ]
  }
};

let state={arch:'stoiker',streak:0,logs:{}};
let currentActionIndex=0;
let showAllG=false,showAllB=false;

function log(d=today()){
  if(!state.logs[d])state.logs[d]={mood:0,good:{},bad:{},plan:[]};
  return state.logs[d];
}

function save(){localStorage.setItem('humaneed5',JSON.stringify(state))}
function load(){
  try{const s=localStorage.getItem('humaneed5');if(s)state=JSON.parse(s)}catch(e){}
}

function compute(d=today()){
  const l=log(d);
  const gC=k=>GOOD.filter(g=>g.t===k&&l.good[g.k]).length;
  const bC=k=>BAD.filter(b=>b.t===k&&l.bad[b.k]).length;
  const mood=l.mood||3;
  
  const calc=k=>{
    const g=gC(k),b=bC(k);
    let v=50+g*15-b*20+(mood-3)*5;
    return clamp(v,0,100);
  };
  
  const scores={};
  TIERS.forEach(t=>scores[t.k]=calc(t.k));
  
  let minK='foundation',minV=100;
  TIERS.forEach(t=>{if(scores[t.k]<minV){minV=scores[t.k];minK=t.k}});
  
  scores.focus=minK;
  scores.mood=mood;
  scores.total=Math.round(TIERS.reduce((s,t)=>s+scores[t.k],0)/6);
  
  return scores;
}

function badge(v){
  if(v>=90)return'Optimal';
  if(v>=75)return'Stark';
  if(v>=60)return'Gut';
  if(v>=45)return'Aufbauend';
  if(v>=30)return'Wachsend';
  return'Startklar';
}

function genPlan(){
  const c=compute();
  const l=log();
  const energy=c.mood>=3?'hi':'lo';
  const pick=arr=>arr[Math.floor(Math.random()*arr.length)];
  
  const plan=[];
  const used=new Set();
  
  const add=(tier)=>{
    const pool=ACTIONS[tier][energy].filter(a=>!used.has(a.t));
    if(pool.length){
      const a=pick(pool);
      used.add(a.t);
      plan.push({id:uid(),text:a.t,tier,why:a.why,how:a.how,min:a.min,done:false});
    }
  };
  
  add('foundation');
  if(c.focus!=='foundation')add(c.focus);
  else add('safety');
  add(ARCH[state.arch]?.tier||'connect');
  
  l.plan=plan;
  currentActionIndex=0;
  save();
}

function addTierAction(tier){
  const l=log();
  const c=compute();
  if(!l.plan)l.plan=[];
  
  const energy=c.mood>=3?'hi':'lo';
  const used=new Set(l.plan.map(p=>p.text));
  const pool=ACTIONS[tier][energy].filter(a=>!used.has(a.t));
  const a=pool.length?pool[Math.floor(Math.random()*pool.length)]:ACTIONS[tier][energy][0];
  
  l.plan.push({id:uid(),text:a.t,tier,why:a.why,how:a.how,min:a.min,done:false});
  currentActionIndex=l.plan.length-1;
  save();
}

// Render functions
function rMoods(){
  $('#moodBar').innerHTML=[1,2,3,4,5].map(v=>
    `<button class="mood-btn${log().mood===v?' on':''}" data-m="${v}"></button>`
  ).join('');
}

function rTiers(){
  const c=compute();
  $('#tiers').innerHTML=TIERS.map(t=>{
    const v=Math.round(c[t.k]);
    return`<div class="tier${c.focus===t.k?' focus':''}" data-t="${t.k}">
      <div class="tier-top">
        <div class="tier-name">${t.n}</div>
        <div class="tier-val" style="color:var(${t.c})">${v}</div>
      </div>
      <div class="tier-bar"><div class="tier-fill" style="width:${v}%;background:var(${t.c})"></div></div>
    </div>`;
  }).join('');
}

let showExplain=false;

function rAction(){
  const l=log();
  const p=l.plan?.[currentActionIndex];
  
  if(!p){
    $('#actionTag').textContent='';
    $('#actionCounter').textContent='';
    $('#actionText').textContent='Wähle deine Stimmung';
    $('#actionExplain').innerHTML='';
    $('#actionExplain').classList.remove('show');
    return;
  }
  
  const tier=TIERS.find(t=>t.k===p.tier);
  $('#actionTag').innerHTML=`${icon(p.tier,'icon-sm')} ${tier?.n||'Aktion'}`;
  $('#actionCounter').textContent=`${currentActionIndex+1}/${l.plan.length}`;
  $('#actionText').textContent=p.text;
  
  // Explanation content
  if(p.why||p.how||p.min){
    $('#actionExplain').innerHTML=`
      <div class="action-explain-row"><div class="action-explain-label">Warum</div><div class="action-explain-text">${p.why||'—'}</div></div>
      <div class="action-explain-row"><div class="action-explain-label">Wie</div><div class="action-explain-text">${p.how||'—'}</div></div>
      <div class="action-explain-row"><div class="action-explain-label">Minimum</div><div class="action-explain-text">${p.min||'—'}</div></div>
    `;
    if(showExplain)$('#actionExplain').classList.add('show');
    else $('#actionExplain').classList.remove('show');
  }else{
    $('#actionExplain').innerHTML='';
    $('#actionExplain').classList.remove('show');
  }
}

function rPlan(){
  const l=log();
  if(!l.plan?.length){$('#planSection').style.display='none';return}
  $('#planSection').style.display='block';
  
  $('#planItems').innerHTML=l.plan.map((p,i)=>{
    const active=i===currentActionIndex;
    return`<div class="plan-item${p.done?' done':''}${active?' active':''}" data-idx="${i}">
      <div class="plan-check">${p.done?'✓':''}</div>
      <div class="plan-item-text">${p.text}</div>
    </div>`;
  }).join('');
}

function rChips(){
  const l=log();
  const gList=showAllG?GOOD:GOOD.slice(0,8);
  const bList=showAllB?BAD:BAD.slice(0,6);
  
  $('#goodChips').innerHTML=gList.map(c=>
    `<div class="chip${l.good[c.k]?' on':''}" data-g="${c.k}">${c.l}</div>`
  ).join('');
  
  $('#badChips').innerHTML=bList.map(c=>
    `<div class="chip bad${l.bad[c.k]?' on':''}" data-b="${c.k}">${c.l}</div>`
  ).join('');
  
  $('#togG').textContent=showAllG?'−':'+';
  $('#togB').textContent=showAllB?'−':'+';
}

function rScore(){
  const c=compute();
  $('#scoreVal').textContent=c.total;
  $('#scoreBadge').textContent=badge(c.total);
  $('#vBase').textContent=Math.round(c.foundation);
  $('#vSafe').textContent=Math.round(c.safety);
  $('#vConn').textContent=Math.round(c.connect);
  $('#vEsteem').textContent=Math.round(c.esteem);
  $('#vSelf').textContent=Math.round(c.self);
  $('#vTrans').textContent=Math.round(c.trans);
  $('#hdrScore').textContent=c.total;
}

function rArch(){
  const a=ARCH[state.arch];
  $('#hdrArch').innerHTML=`${icon(a.e,'icon-sm')} ${a.n}`;
}

function rArchGrid(){
  $('#archGrid').innerHTML=ARCH_ORDER.map(k=>{
    const a=ARCH[k];
    return`<div class="arch-opt${state.arch===k?' on':''}" data-a="${k}">
      <div class="arch-opt-icon">${icon(a.e,'icon-md')}</div>
      <div class="arch-opt-name">${a.n}</div>
    </div>`;
  }).join('');
}

function rJournal(){
  const entries=Object.entries(state.logs).filter(([_,l])=>l.mood).sort((a,b)=>b[0].localeCompare(a[0])).slice(0,7);
  if(!entries.length){$('#journal').innerHTML='<div class="insight">Noch keine Einträge</div>';return}
  
  const colors=['#C62828','#EF6C00','#F9A825','#7CB342','#43A047'];
  const WD=['So','Mo','Di','Mi','Do','Fr','Sa'];
  
  $('#journal').innerHTML=entries.map(([d,l])=>{
    const dt=new Date(d+'T12:00:00');
    const c=compute(d);
    const done=(l.plan||[]).filter(p=>p.done).length;
    const total=(l.plan||[]).length;
    return`<div class="journal-day">
      <div class="journal-day-header">
        <div class="journal-date">${WD[dt.getDay()]} ${dt.getDate()}.${dt.getMonth()+1}</div>
        <div class="journal-meta">
          <div class="journal-mood" style="background:${colors[l.mood-1]}"></div>
          <div class="journal-score">${Math.round(c.total)}</div>
        </div>
      </div>
      <div class="journal-summary">${MOOD_N[l.mood-1]} · ${done}/${total} erledigt</div>
    </div>`;
  }).join('');
}

function rInsights(){
  const c=compute();
  const insights=[];
  
  if(c.foundation<50)insights.push('Basis stärken: Schlaf und Bewegung priorisieren');
  if(c.connect<50)insights.push('Verbindung fehlt: Heute jemanden kontaktieren');
  if(c.mood<=2)insights.push('Niedrige Energie: Nur Minimum-Versionen heute');
  
  if(!insights.length)insights.push('Alles im grünen Bereich!');
  
  $('#insights').innerHTML=insights.map(i=>`<div class="insight">${i}</div>`).join('');
}

function render(){
  rArch();rMoods();rTiers();rAction();rPlan();rChips();rScore();rInsights();rJournal();
}

function toast(m){
  const t=$('#toast');
  t.textContent=m;
  t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),2000);
}

// Events
$('#moodBar').addEventListener('click',e=>{
  const btn=e.target.closest('.mood-btn');
  if(!btn)return;
  log().mood=+btn.dataset.m;
  if(!log().plan?.length)genPlan();
  save();render();
});

$('#btnWhy').addEventListener('click',()=>{
  showExplain=!showExplain;
  $('#actionExplain').classList.toggle('show',showExplain);
});

$('#btnDone').addEventListener('click',()=>{
  const l=log();
  if(!l.plan?.[currentActionIndex])return;
  l.plan[currentActionIndex].done=true;
  currentActionIndex=Math.min(currentActionIndex+1,l.plan.length-1);
  save();render();
  toast('Erledigt! ✓');
});

$('#btnSkip').addEventListener('click',()=>{
  const l=log();
  if(!l.plan?.length)return;
  currentActionIndex=(currentActionIndex+1)%l.plan.length;
  render();
});

$('#planItems').addEventListener('click',e=>{
  const item=e.target.closest('.plan-item');
  if(!item)return;
  currentActionIndex=+item.dataset.idx;
  render();
});

$('#regenPlan').addEventListener('click',()=>{genPlan();render();toast('Neuer Plan!')});

$('#tiers').addEventListener('click',e=>{
  const tier=e.target.closest('.tier');
  if(!tier)return;
  addTierAction(tier.dataset.t);
  render();
  toast(`+1 ${TIERS.find(t=>t.k===tier.dataset.t)?.n}`);
});

$('#goodChips').addEventListener('click',e=>{
  const chip=e.target.closest('.chip');
  if(!chip)return;
  const l=log();
  l.good[chip.dataset.g]=!l.good[chip.dataset.g];
  save();render();
});

$('#badChips').addEventListener('click',e=>{
  const chip=e.target.closest('.chip');
  if(!chip)return;
  const l=log();
  l.bad[chip.dataset.b]=!l.bad[chip.dataset.b];
  save();render();
});

$('#togG').addEventListener('click',()=>{showAllG=!showAllG;rChips()});
$('#togB').addEventListener('click',()=>{showAllB=!showAllB;rChips()});

$$('nav button').forEach(btn=>btn.addEventListener('click',function(){
  $$('nav button').forEach(b=>b.classList.remove('on'));
  this.classList.add('on');
  $$('.view').forEach(v=>v.classList.remove('on'));
  $(`#v-${this.dataset.v}`).classList.add('on');
  if(this.dataset.v==='journal'){rInsights();rJournal()}
}));

$('#hdrArch').addEventListener('click',()=>{rArchGrid();$('#modal').classList.add('show')});
$('#closeModal').addEventListener('click',()=>{$('#modal').classList.remove('show')});
$('#modal').addEventListener('click',e=>{if(e.target===$('#modal'))$('#modal').classList.remove('show')});

$('#archGrid').addEventListener('click',e=>{
  const opt=e.target.closest('.arch-opt');
  if(!opt)return;
  state.arch=opt.dataset.a;
  save();render();rArchGrid();
  toast(`${ARCH[state.arch].n} gewählt`);
});

load();render();
})();
</script>
</body>
</html>
