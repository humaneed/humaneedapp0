<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="theme-color" content="#0d1117">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="HUMANEED">
<title>HUMANEED v3</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
:root{--bg:#0d1117;--bg2:#161b22;--card:#1c2128;--surface:#252c35;--text:#e6edf3;--sub:#8b949e;--muted:#6e7681;--accent:#c9b1ff;--accent-soft:rgba(201,177,255,.12);--accent-glow:rgba(201,177,255,.25);--petrol:#4ecdc4;--positive:#7ee787;--positive-soft:rgba(126,231,135,.1);--critical:#f85149;--critical-soft:rgba(248,81,73,.1);--line:rgba(139,148,158,.15);--hairline:rgba(139,148,158,.08);--r:10px;--r-sm:6px}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',system-ui,sans-serif;background:var(--bg);color:var(--text);min-height:100dvh;display:flex;justify-content:center;font-size:14px;line-height:1.5}
#app{width:100%;max-width:420px;display:flex;flex-direction:column;min-height:100dvh}
header{height:58px;padding:0 20px;display:flex;align-items:center;justify-content:space-between;background:var(--bg2);border-bottom:1px solid var(--hairline)}
.logo{font-weight:600;font-size:16px}.logo span{color:var(--accent)}
.hdr-r{display:flex;gap:10px;align-items:center}
.pill{height:34px;padding:0 14px;border-radius:17px;border:1px solid var(--line);background:var(--card);font-size:13px;font-weight:500;color:var(--sub);cursor:pointer;display:flex;align-items:center;gap:6px}
.pill.gold{color:var(--accent);border-color:var(--accent-glow);background:var(--accent-soft)}
main{flex:1;overflow-y:auto;padding:20px;padding-bottom:88px}
nav{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:420px;height:68px;background:var(--bg2);border-top:1px solid var(--hairline);display:flex;padding:10px 12px;gap:8px}
nav button{flex:1;background:var(--card);border:1px solid transparent;border-radius:var(--r);color:var(--muted);font-size:11px;font-weight:600;cursor:pointer;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px}
nav button.on{background:var(--accent-soft);border-color:var(--accent-glow);color:var(--accent)}
nav button span{font-size:18px}
.view{display:none}.view.on{display:block}
.sec{margin-bottom:24px}.sec-t{font-size:11px;font-weight:600;letter-spacing:.08em;text-transform:uppercase;color:var(--muted);margin-bottom:12px}
.card{background:var(--card);border:1px solid var(--line);border-radius:var(--r);padding:18px}
.btn{height:46px;padding:0 22px;border-radius:var(--r);border:1px solid var(--line);background:var(--card);font:inherit;font-size:13px;font-weight:600;color:var(--sub);cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px}
.btn.primary{background:var(--accent);border-color:var(--accent);color:var(--bg)}
.btn-row{display:flex;gap:10px}.btn-row .btn{flex:1}
.wheel-box{position:relative;width:100%;max-width:260px;margin:0 auto;aspect-ratio:1}
.wheel-box svg{width:100%;height:100%}
.wheel-center{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;pointer-events:none}
.wheel-score{font-size:36px;font-weight:700}.wheel-label{font-size:10px;color:var(--muted);text-transform:uppercase}
.rec{background:var(--card);background-image:linear-gradient(135deg,var(--accent-soft),transparent 70%);border:1px solid var(--accent-glow);border-radius:var(--r);padding:18px}
.rec-head{display:flex;align-items:center;gap:14px;margin-bottom:16px}
.rec-icon{font-size:28px}.rec-info{flex:1}
.rec-why{font-size:10px;font-weight:600;letter-spacing:.06em;text-transform:uppercase;color:var(--accent)}
.rec-task{font-size:15px;font-weight:600;margin-top:4px;line-height:1.45}
.coach{background:var(--surface);border:1px solid var(--hairline);border-radius:var(--r);padding:16px}
.coach-title{font-size:11px;font-weight:600;color:var(--accent);margin-bottom:8px}
.coach-msg{font-size:13px;color:var(--sub);line-height:1.6}
.impulse{background:var(--card);border:1px solid var(--accent-glow);border-radius:var(--r);padding:18px;margin-top:20px}
.impulse-head{display:flex;align-items:center;gap:12px;margin-bottom:14px}
.impulse-icon{font-size:22px}.impulse-tier{font-size:12px;font-weight:600;flex:1}
.impulse-x{width:30px;height:30px;border-radius:50%;border:1px solid var(--line);background:var(--surface);color:var(--muted);cursor:pointer;display:flex;align-items:center;justify-content:center}
.impulse-task{font-size:16px;font-weight:600;line-height:1.5;margin-bottom:14px}
.impulse-detail{background:var(--surface);border-radius:var(--r-sm);padding:14px;margin-bottom:16px}
.impulse-row{font-size:12px;color:var(--sub);line-height:1.55;margin-bottom:8px}
.impulse-row b{color:var(--accent);margin-right:8px}
.impulse-btns{display:grid;grid-template-columns:1fr 1fr;gap:10px}.impulse-btns .btn{height:42px;font-size:12px}
.tier-row{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
.tier-btn{width:48px;height:48px;border-radius:50%;border:2px solid var(--line);background:var(--surface);font-size:18px;cursor:pointer;opacity:.5}
.tier-btn.on{opacity:1;border-color:var(--c)}
.gen-card{text-align:center}
.gen-tier{font-size:11px;font-weight:600;text-transform:uppercase;margin-bottom:12px}
.gen-task{font-size:16px;font-weight:600;line-height:1.5;min-height:52px;margin-bottom:16px}
.gen-detail{background:var(--surface);border-radius:var(--r-sm);padding:14px;margin-bottom:18px;text-align:left}
.gen-row{font-size:12px;color:var(--sub);line-height:1.55;margin-bottom:8px}
.gen-row b{color:var(--accent);width:55px;display:inline-block}
.hist{background:var(--surface);border-radius:var(--r-sm);padding:12px 14px;margin-bottom:8px;font-size:13px;color:var(--sub);display:flex;align-items:center;gap:10px}
.hist strong{color:var(--text)}
.breakdown{margin-top:16px}
.bd-row{display:flex;align-items:center;gap:10px;padding:10px 0;border-bottom:1px solid var(--hairline)}
.bd-icon{font-size:16px;width:28px}.bd-name{flex:1;font-size:12px}.bd-bar{width:80px;height:6px;background:var(--surface);border-radius:3px;overflow:hidden}
.bd-fill{height:100%;border-radius:3px}.bd-val{font-size:12px;font-weight:600;color:var(--accent);width:28px;text-align:right}
/* CHECK-IN */
.mood-box{text-align:center;padding:20px 0}
.mood-q{font-size:16px;font-weight:600;margin-bottom:20px}
.mood-row{display:flex;justify-content:center;gap:16px}
.mood-btn{width:52px;height:52px;border-radius:50%;border:2px solid transparent;cursor:pointer}
.mood-btn[data-m="1"]{background:linear-gradient(180deg,#f87171,#dc2626)}
.mood-btn[data-m="2"]{background:linear-gradient(180deg,#fb923c,#ea580c)}
.mood-btn[data-m="3"]{background:linear-gradient(180deg,#a8a29e,#78716c)}
.mood-btn[data-m="4"]{background:linear-gradient(180deg,#86efac,#22c55e)}
.mood-btn[data-m="5"]{background:linear-gradient(180deg,#4ade80,#16a34a)}
.mood-btn.on{transform:scale(.92);border-color:var(--text)}
.mood-label{margin-top:16px;font-size:13px;font-weight:600;color:var(--accent);min-height:20px}
.bio-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.bio-item{background:var(--surface);border:1px solid var(--hairline);border-radius:var(--r);padding:14px}
.bio-item.wide{grid-column:span 2}
.bio-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.bio-label{font-size:12px;font-weight:600;color:var(--sub)}
.bio-value{font-size:14px;font-weight:700;color:var(--accent)}
.bio-slider{width:100%;height:6px;-webkit-appearance:none;background:var(--card);border-radius:3px}
.bio-slider::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;border-radius:50%;background:var(--accent);cursor:pointer}
.bio-slider.cyan::-webkit-slider-thumb{background:var(--petrol)}
.bio-slider.green::-webkit-slider-thumb{background:var(--positive)}
.bio-hint{font-size:10px;color:var(--muted);margin-top:8px}
.mental-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.mental-item{background:var(--surface);border:1px solid var(--accent-glow);border-radius:var(--r);padding:14px}
.chips{display:flex;flex-wrap:wrap;gap:10px}
.chip{height:40px;padding:0 16px;border-radius:20px;border:1px solid var(--line);background:var(--card);font-size:13px;color:var(--sub);cursor:pointer;display:flex;align-items:center;gap:8px}
.chip.on{border-color:var(--positive);background:var(--positive-soft);color:var(--positive)}
.chip.bad.on{border-color:var(--critical);background:var(--critical-soft);color:var(--critical)}
/* PROFILE */
.tabs{display:flex;gap:6px;background:var(--surface);padding:6px;border-radius:var(--r);margin-bottom:20px}
.tab{flex:1;height:40px;border-radius:var(--r-sm);border:none;background:transparent;color:var(--muted);font:inherit;font-size:12px;font-weight:600;cursor:pointer}
.tab.on{background:var(--card);color:var(--text)}
.arch-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.arch{background:var(--card);border:1px solid var(--line);border-radius:var(--r);padding:14px 8px;text-align:center;cursor:pointer}
.arch.on{border-color:var(--accent);background:var(--accent-soft)}
.arch-e{font-size:26px}.arch-n{font-size:12px;font-weight:600;margin-top:6px}.arch-d{font-size:10px;color:var(--muted);margin-top:3px}
.arch-detail{margin-top:16px}
.arch-head{display:flex;align-items:center;gap:14px;margin-bottom:14px}
.arch-big{font-size:36px}.arch-info h3{font-size:17px;font-weight:600}.arch-info p{font-size:12px;color:var(--muted);margin-top:3px}
.traits{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
.trait{padding:6px 12px;border-radius:var(--r-sm);background:var(--surface);font-size:11px;color:var(--sub)}
.stats{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
.stat{background:var(--surface);border-radius:var(--r);padding:16px;text-align:center}
.stat-v{font-size:28px;font-weight:700;color:var(--accent)}.stat-l{font-size:10px;color:var(--muted);text-transform:uppercase;margin-top:6px}
.insight{background:var(--surface);border-radius:var(--r-sm);padding:14px;margin-bottom:10px;font-size:13px;color:var(--sub)}
.insight strong{color:var(--text)}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.7);display:none;align-items:center;justify-content:center;padding:20px;z-index:100}
.modal.on{display:flex}
.modal-box{background:var(--card);border:1px solid var(--line);border-radius:var(--r);padding:24px;width:100%;max-width:360px;max-height:80vh;overflow-y:auto}
.modal-title{font-size:16px;font-weight:600;margin-bottom:16px;text-align:center}
.toast{position:fixed;bottom:90px;left:50%;transform:translateX(-50%) translateY(20px);background:var(--card);border:1px solid var(--accent-glow);border-radius:var(--r);padding:12px 20px;font-size:13px;opacity:0;transition:all .3s;pointer-events:none;z-index:200}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
.empty{text-align:center;padding:30px;color:var(--muted);font-size:13px}
.sub{display:none}.sub.on{display:block}
</style>
</head>
<body>
<div id="app">
  <header>
    <div class="logo">HUMAN<span>EED</span></div>
    <div class="hdr-r">
      <div class="pill" id="streakPill">üî• <span id="streakVal">0</span></div>
      <div class="pill gold" id="archPill">‚öîÔ∏è</div>
    </div>
  </header>
  
  <main>
    <!-- HOME -->
    <section class="view on" id="v-home">
      <div class="sec">
        <div class="wheel-box">
          <svg id="wheelSvg" viewBox="0 0 300 300"></svg>
          <div class="wheel-center">
            <div class="wheel-score" id="centerScore">60</div>
            <div class="wheel-label">Balance</div>
          </div>
        </div>
        <div class="breakdown" id="breakdown"></div>
      </div>
      <div class="sec">
        <div class="sec-t">Smart-Empfehlung</div>
        <div class="rec">
          <div class="rec-head">
            <div class="rec-icon" id="recIcon">üåø</div>
            <div class="rec-info">
              <div class="rec-why" id="recWhy">Basis st√§rken</div>
              <div class="rec-task" id="recTask">10 Min spazieren</div>
            </div>
          </div>
          <div class="btn-row">
            <button class="btn" id="recSkip">Andere</button>
            <button class="btn primary" id="recDo">‚Üí Jetzt</button>
          </div>
        </div>
      </div>
      <div class="sec">
        <div class="sec-t">Coach</div>
        <div class="coach">
          <div class="coach-title" id="coachTitle">üí¨ Tages-Tipp</div>
          <div class="coach-msg" id="coachMsg">Starte mit kleinen Schritten.</div>
        </div>
      </div>
      <div id="impulseBox"></div>
    </section>

    <!-- AKTION -->
    <section class="view" id="v-action">
      <div class="sec">
        <div class="sec-t">Ebene w√§hlen</div>
        <div class="tier-row" id="tierRow"></div>
      </div>
      <div class="sec">
        <div class="card gen-card">
          <div class="gen-tier" id="genTier">üåø Basis</div>
          <div class="gen-task" id="genTask">Wasser trinken</div>
          <div class="gen-detail" id="genDetail"></div>
          <div class="btn-row">
            <button class="btn" id="genSkip">Andere</button>
            <button class="btn primary" id="genDone">‚úì Erledigt</button>
          </div>
        </div>
      </div>
      <div class="sec">
        <div class="sec-t">Letzte Aktionen</div>
        <div id="histList"></div>
      </div>
    </section>

    <!-- CHECK-IN (ERWEITERT) -->
    <section class="view" id="v-checkin">
      <div class="sec">
        <div class="mood-box">
          <div class="mood-q">Wie geht es dir gerade?</div>
          <div class="mood-row">
            <button class="mood-btn" data-m="1"></button>
            <button class="mood-btn" data-m="2"></button>
            <button class="mood-btn" data-m="3"></button>
            <button class="mood-btn" data-m="4"></button>
            <button class="mood-btn" data-m="5"></button>
          </div>
          <div class="mood-label" id="moodLabel"></div>
        </div>
      </div>
      
      <div class="sec">
        <div class="sec-t">‚Äï Biomarker</div>
        <div class="bio-grid">
          <div class="bio-item"><div class="bio-head"><span class="bio-label">‚óã Schlaf</span><span class="bio-value" id="bioSleepVal">7h</span></div><input type="range" class="bio-slider" id="bioSleep" min="0" max="12" step="0.5" value="7"><div class="bio-hint">Stunden letzte Nacht</div></div>
          <div class="bio-item"><div class="bio-head"><span class="bio-label">‚óá Qualit√§t</span><span class="bio-value" id="bioQualVal">3</span></div><input type="range" class="bio-slider cyan" id="bioQual" min="1" max="5" step="1" value="3"><div class="bio-hint">1=schlecht, 5=super</div></div>
          <div class="bio-item"><div class="bio-head"><span class="bio-label">‚ñ≥ Schritte</span><span class="bio-value" id="bioStepsVal">5k</span></div><input type="range" class="bio-slider green" id="bioSteps" min="0" max="20000" step="500" value="5000"><div class="bio-hint">Heute (ca.)</div></div>
          <div class="bio-item"><div class="bio-head"><span class="bio-label">‚ñ° Training</span><span class="bio-value" id="bioTrainVal">0m</span></div><input type="range" class="bio-slider" id="bioTrain" min="0" max="120" step="5" value="0"><div class="bio-hint">Minuten heute</div></div>
        </div>
      </div>

      <div class="sec">
        <div class="sec-t">‚óà Mental State</div>
        <div class="mental-grid">
          <div class="mental-item"><div class="bio-head"><span class="bio-label">‚óé Kontrolle</span><span class="bio-value" id="menLocusVal">50</span></div><input type="range" class="bio-slider" id="menLocus" min="0" max="100" step="5" value="50"><div class="bio-hint">Locus of Control</div></div>
          <div class="mental-item"><div class="bio-head"><span class="bio-label">‚óâ Intention</span><span class="bio-value" id="menIntentVal">50</span></div><input type="range" class="bio-slider" id="menIntent" min="0" max="100" step="5" value="50"><div class="bio-hint">Handlungsabsicht</div></div>
          <div class="mental-item"><div class="bio-head"><span class="bio-label">‚óà Wirksamkeit</span><span class="bio-value" id="menEfficVal">50</span></div><input type="range" class="bio-slider" id="menEffic" min="0" max="100" step="5" value="50"><div class="bio-hint">Selbstwirksamkeit</div></div>
          <div class="mental-item"><div class="bio-head"><span class="bio-label">‚óá Narrativ</span><span class="bio-value" id="menNarrVal">50</span></div><input type="range" class="bio-slider" id="menNarr" min="0" max="100" step="5" value="50"><div class="bio-hint">Selbstbild</div></div>
        </div>
      </div>

      <div class="sec">
        <div class="sec-t">‚úì Was lief gut?</div>
        <div class="chips" id="goodChips"></div>
      </div>
      <div class="sec">
        <div class="sec-t">‚úó Was war schwierig?</div>
        <div class="chips" id="badChips"></div>
      </div>
    </section>

    <!-- PROFIL -->
    <section class="view" id="v-profile">
      <div class="tabs">
        <button class="tab on" data-t="arch">‚Ä¢ Vorbild</button>
        <button class="tab" data-t="journal">‚Ä¢ Journal</button>
      </div>
      <div class="sub on" id="sub-arch">
        <div class="sec"><div class="arch-grid" id="archGrid"></div></div>
        <div class="sec" id="archDetail"></div>
      </div>
      <div class="sub" id="sub-journal" style="display:none">
        <div class="sec">
          <div class="stats">
            <div class="stat"><div class="stat-v" id="statStreak">0</div><div class="stat-l">Streak</div></div>
            <div class="stat"><div class="stat-v" id="statActions">0</div><div class="stat-l">Aktionen</div></div>
            <div class="stat"><div class="stat-v" id="statScore">60</div><div class="stat-l">Score</div></div>
          </div>
        </div>
        <div class="sec"><div class="sec-t">Erkenntnisse</div><div id="insights"></div></div>
      </div>
    </section>
  </main>
  
  <nav>
    <button data-v="action"><span>‚Üí</span>Aktion</button>
    <button class="on" data-v="home"><span>‚óã</span>Home</button>
    <button data-v="checkin"><span>‚óê</span>Check-in</button>
    <button data-v="profile"><span>‚â°</span>Profil</button>
  </nav>
</div>

<div class="modal" id="modal">
  <div class="modal-box">
    <div class="modal-title">Vorbild w√§hlen</div>
    <div class="arch-grid" id="modalArchGrid"></div>
    <button class="btn primary" id="modalClose" style="width:100%;margin-top:16px">Schlie√üen</button>
  </div>
</div>
<div class="toast" id="toast"></div>

<script>
const $=s=>document.querySelector(s),$$=s=>document.querySelectorAll(s);

const TIERS=[
  {k:'foundation',n:'Basis',e:'üåø',c:'#4CAF50'},
  {k:'safety',n:'Sicherheit',e:'üõ°Ô∏è',c:'#29B6F6'},
  {k:'connect',n:'Verbindung',e:'üíú',c:'#AB47BC'},
  {k:'esteem',n:'Selbstwert',e:'‚≠ê',c:'#FFA726'},
  {k:'growth',n:'Wachstum',e:'üå±',c:'#EC407A'},
  {k:'transcend',n:'Beitrag',e:'‚ú®',c:'#F06292'}
];

// 15 ARCHETYPES - kompakt mit Farben
const ARCHETYPES={
  warrior:{e:'‚öîÔ∏è',n:'Krieger',d:'Mut & Disziplin',color:'#ef4444',traits:['Disziplin','Ausdauer','Mut','Schutz','Entschlossenheit'],philosophy:'Der wahre Krieger k√§mpft gegen seine eigenen Schw√§chen.',icons:['Marcus Aurelius','David Goggins'],tone:{anrede:'Krieger',motiv:'St√§rke w√§chst durch Taten.'}},
  sage:{e:'üìö',n:'Weiser',d:'Wissen & Klarheit',color:'#6366f1',traits:['Reflexion','Lernen','Tiefe','Klarheit','Geduld'],philosophy:'Angewandtes Wissen ist Macht.',icons:['Seneca','Naval Ravikant'],tone:{anrede:'Weiser',motiv:'Weisheit entsteht durch bewusstes Handeln.'}},
  creator:{e:'üé®',n:'Sch√∂pfer',d:'Kreativit√§t & Vision',color:'#f97316',traits:['Innovation','Vision','Ausdruck','Freiheit','Originalit√§t'],philosophy:'Kreativit√§t ist h√∂chste Denkform.',icons:['Da Vinci','Steve Jobs'],tone:{anrede:'Sch√∂pfer',motiv:'Jede Handlung ist ein Pinselstrich.'}},
  caregiver:{e:'üíö',n:'Besch√ºtzer',d:'F√ºrsorge & Empathie',color:'#22c55e',traits:['Mitgef√ºhl','F√ºrsorge','Geduld','Heilung','Pr√§senz'],philosophy:'Man kann nur geben, was man hat.',icons:['Mr. Rogers'],tone:{anrede:'Besch√ºtzer',motiv:'Selbstf√ºrsorge erm√∂glicht F√ºrsorge.'}},
  explorer:{e:'üß≠',n:'Entdecker',d:'Neugier & Abenteuer',color:'#eab308',traits:['Neugier','Freiheit','Mut','Offenheit','Anpassung'],philosophy:'Das gr√∂√üte Abenteuer ist das Leben.',icons:['Bear Grylls'],tone:{anrede:'Entdecker',motiv:'Jeder Tag birgt neue Entdeckungen.'}},
  leader:{e:'üëë',n:'Anf√ºhrer',d:'Vision & Verantwortung',color:'#a855f7',traits:['Vision','Einfluss','Verantwortung','Inspiration','Integrit√§t'],philosophy:'Leadership ist Service.',icons:['Mandela','Lincoln'],tone:{anrede:'Anf√ºhrer',motiv:'Du gehst voran ‚Äì andere folgen.'}},
  healer:{e:'üå∏',n:'Heiler',d:'Ganzheit & Balance',color:'#ec4899',traits:['Intuition','Ganzheit','Regeneration','Sanftheit','Balance'],philosophy:'Der K√∂rper heilt sich selbst.',icons:['Hippokrates'],tone:{anrede:'Heiler',motiv:'Heilung beginnt mit Erlaubnis.'}},
  rebel:{e:'üî•',n:'Rebell',d:'Authentizit√§t & Wandel',color:'#f43f5e',traits:['Authentizit√§t','Nonkonformit√§t','Mut','Wandel','Ehrlichkeit'],philosophy:'Wer ver√§ndern will, muss anders sein.',icons:['Jobs','Chanel'],tone:{anrede:'Rebell',motiv:'Regeln sind f√ºr Menschen ohne Denken.'}},
  monk:{e:'üßò',n:'M√∂nch',d:'Stille & Fokus',color:'#64748b',traits:['Stille','Fokus','Gelassenheit','Disziplin','Achtsamkeit'],philosophy:'Weniger ist mehr.',icons:['Thich Nhat Hanh'],tone:{anrede:'M√∂nch',motiv:'In der Stille findest du Antworten.'}},
  athlete:{e:'üèÜ',n:'Athlet',d:'K√∂rper & Leistung',color:'#14b8a6',traits:['K√∂rperbewusstsein','Ausdauer','Leistung','Regeneration','Fokus'],philosophy:'Excellence ist Gewohnheit.',icons:['Jordan','Wim Hof'],tone:{anrede:'Athlet',motiv:'Dein K√∂rper ist dein Instrument.'}},
  artist:{e:'üé≠',n:'K√ºnstler',d:'Ausdruck & Emotion',color:'#d946ef',traits:['Sensibilit√§t','Ausdruck','Emotion','Sch√∂nheit','Tiefe'],philosophy:'Kunst zeigt, was andere sehen l√§sst.',icons:['Frida Kahlo','Van Gogh'],tone:{anrede:'K√ºnstler',motiv:'Erschaffe. Expresse. Existiere.'}},
  scientist:{e:'üî¨',n:'Forscher',d:'Wahrheit & Methode',color:'#0ea5e9',traits:['Analytik','Neugier','Pr√§zision','Skeptizismus','Ausdauer'],philosophy:'Ich wei√ü, dass ich nichts wei√ü.',icons:['Curie','Sagan'],tone:{anrede:'Forscher',motiv:'Fakten z√§hlen. Hypothesen testen.'}},
  mentor:{e:'üéì',n:'Mentor',d:'Weitergabe & Verm√§chtnis',color:'#8b5cf6',traits:['Geduld','Erfahrung','Anleitung','Gro√üz√ºgigkeit','Weitsicht'],philosophy:'Lehren ist zweimal lernen.',icons:['Sokrates'],tone:{anrede:'Mentor',motiv:'Dein gr√∂√ütes Werk sind Menschen.'}},
  stoic:{e:'üèõÔ∏è',n:'Stoiker',d:'Gelassenheit & Akzeptanz',color:'#78716c',traits:['Gelassenheit','Selbstkontrolle','Akzeptanz','Rationalit√§t','Resilienz'],philosophy:'Es sind nicht die Dinge, die uns beunruhigen.',icons:['Marcus Aurelius','Ryan Holiday'],tone:{anrede:'Stoiker',motiv:'Kontrolliere was du kannst.'}},
  mystic:{e:'üåô',n:'Mystiker',d:'Intuition & Tiefe',color:'#7c3aed',traits:['Intuition','Spiritualit√§t','Tiefe','Verbundenheit','Transformation'],philosophy:'Das Universum ist in dir.',icons:['Rumi','Alan Watts'],tone:{anrede:'Mystiker',motiv:'Hinter dem Sichtbaren liegt Wahrheit.'}}
};

// AKTIONEN - zusammengefasst nach Tier (je ~20 Aktionen)
const ACTIONS={
  foundation:[
    {t:'10 Min spazieren',h:'Geh raus, atme bewusst.',w:'Bewegung aktiviert Kreislauf.',tags:['explorer','warrior','athlete'],energy:'low'},
    {t:'Gro√ües Glas Wasser',h:'500ml langsam trinken.',w:'Dehydration = M√ºdigkeit.',tags:['all'],energy:'low'},
    {t:'5 Min Dehnen',h:'Nacken, Schultern, R√ºcken.',w:'L√∂st Verspannungen.',tags:['athlete','healer','monk'],energy:'low'},
    {t:'Gesunder Snack',h:'Obst, N√ºsse, Gem√ºse.',w:'Stabile Energie.',tags:['caregiver','healer'],energy:'low'},
    {t:'Atem√ºbung (4-4-6)',h:'4s ein, 4s halten, 6s aus.',w:'Aktiviert Parasympathikus.',tags:['monk','stoic','healer','sage'],energy:'low'},
    {t:'Fenster √∂ffnen',h:'10x tief durchatmen.',w:'Sauerstoff macht wach.',tags:['all'],energy:'low'},
    {t:'Kalte Dusche (30s)',h:'Am Ende: Kalt stellen.',w:'St√§rkt Willenskraft.',tags:['warrior','stoic','athlete','rebel'],energy:'high',time:'morning'},
    {t:'10 Liegest√ºtze',h:'Saubere Form.',w:'Kurze Belastung = Energie.',tags:['warrior','athlete','leader'],energy:'medium'},
    {t:'Yoga Sonnengru√ü',h:'3 Runden flie√üend.',w:'Ganzheitliche Mobilisierung.',tags:['healer','monk','athlete'],energy:'medium',time:'morning'},
    {t:'Barfu√ü laufen',h:'5 Min auf Gras/Sand.',w:'Erdung und Pr√§senz.',tags:['explorer','healer','mystic'],energy:'low'},
    {t:'Proteinreiche Mahlzeit',h:'Eier, Quark, H√ºlsenfr√ºchte.',w:'Stabiler Blutzucker.',tags:['athlete','warrior','scientist'],energy:'low'},
    {t:'Gr√ºnes Gem√ºse',h:'Brokkoli, Spinat, Salat.',w:'Mikron√§hrstoffe.',tags:['healer','caregiver','sage'],energy:'low'},
    {t:'Kr√§utertee',h:'Pfefferminze, Kamille, Ingwer.',w:'Hydration + Wirkstoffe.',tags:['healer','monk','mystic'],energy:'low',time:'evening'},
    {t:'Box Breathing',h:'4s ein, 4s halten, 4s aus, 4s halten.',w:'Navy SEAL Technik.',tags:['warrior','stoic','athlete'],energy:'low'},
    {t:'Power Nap',h:'15-20 Min, Timer stellen.',w:'Regeneriert Aufmerksamkeit.',tags:['sage','creator','scientist'],energy:'low'},
    {t:'Sonnenlicht tanken',h:'10 Min direktes Tageslicht.',w:'Synchronisiert Rhythmus.',tags:['scientist','healer','explorer'],energy:'low',time:'morning'},
    {t:'K√∂rperhaltung korrigieren',h:'Schultern zur√ºck, Brust raus.',w:'Aufrecht = selbstsicher.',tags:['leader','warrior','stoic'],energy:'low'},
    {t:'Treppen statt Aufzug',h:'Bewusst Treppe w√§hlen.',w:'Integrierte Bewegung.',tags:['all'],energy:'medium'},
    {t:'Tanz zu einem Song',h:'3-4 Min bewegen.',w:'Bewegung mit Freude.',tags:['artist','creator','rebel'],energy:'high'},
    {t:'Body Scan',h:'Langsam durch K√∂rper sp√ºren.',w:'Was braucht Aufmerksamkeit?',tags:['healer','monk','mystic'],energy:'low',time:'evening'},
    {t:'Bildschirm-Pause',h:'30 Min ohne Screen.',w:'Blaulicht st√∂rt Melatonin.',tags:['monk','sage','scientist'],energy:'low',time:'evening'}
  ],
  safety:[
    {t:'Schreibtisch aufr√§umen',h:'Alles weg was nicht gebraucht wird.',w:'√Ñu√üere Ordnung = innere Ruhe.',tags:['warrior','leader','monk','stoic'],energy:'medium'},
    {t:'Eine Schublade aufr√§umen',h:'10 Min, eine Schublade.',w:'Kleine Siege bauen Momentum.',tags:['caregiver','sage'],energy:'low'},
    {t:'Inbox Zero',h:'E-Mails auf Null/kategorisieren.',w:'Offene Loops stressen.',tags:['leader','scientist','sage'],energy:'medium'},
    {t:'Morgen-Routine planen',h:'3-5 Schritte f√ºr morgen.',w:'Struktur reduziert Entscheidungsm√ºdigkeit.',tags:['leader','warrior','stoic'],energy:'low',time:'evening'},
    {t:'Wochenplanung',h:'15 Min: Top 3 Ziele.',w:'Proaktiv statt reaktiv.',tags:['leader','sage','scientist'],energy:'medium'},
    {t:'Finanz√ºberblick',h:'Einnahmen vs. Ausgaben.',w:'Klarheit = weniger Stress.',tags:['leader','sage','stoic'],energy:'medium'},
    {t:'Handy auf Flugmodus',h:'1 Stunde ohne Unterbrechungen.',w:'Benachrichtigungen fragmentieren.',tags:['monk','scientist','creator'],energy:'low'},
    {t:'Nein sagen',h:'Eine Anfrage ablehnen.',w:'Grenzen sch√ºtzen Energie.',tags:['warrior','stoic','rebel','leader'],energy:'high'},
    {t:'Social Media Pause',h:'Heute keine Social Media.',w:'Dopamin-Reset.',tags:['monk','stoic','scientist'],energy:'medium'},
    {t:'Fokusblock einrichten',h:'90 Min ungest√∂rte Zeit.',w:'Deep Work braucht Schutz.',tags:['scientist','creator','sage'],energy:'medium'},
    {t:'Backup erstellen',h:'Wichtige Dateien sichern.',w:'Datenverlust vermeiden.',tags:['sage','scientist','leader'],energy:'low'},
    {t:'Sorgen aufschreiben',h:'Alles notieren was beunruhigt.',w:'Externalisieren = Distanz.',tags:['sage','creator','scientist'],energy:'low',time:'evening'},
    {t:'Worst-Case durchdenken',h:'Was w√§re das Schlimmste?',w:'Premeditatio Malorum.',tags:['stoic','sage','warrior'],energy:'medium'},
    {t:'Kontrollkreise zeichnen',h:'Was kann ich kontrollieren?',w:'Fokus auf Beeinflussbares.',tags:['stoic','sage','scientist'],energy:'low'},
    {t:'Digitale Ordnung',h:'Downloads aufr√§umen.',w:'Digitales Chaos stresst.',tags:['scientist','leader','sage'],energy:'low'},
    {t:'Buffer-Zeit einplanen',h:'30 Min Puffer zwischen Terminen.',w:'Reduziert Zeitdruck.',tags:['sage','caregiver','healer'],energy:'low'}
  ],
  connect:[
    {t:'Freund anrufen',h:'Frag wie es wirklich geht.',w:'Soziale Verbindung = Oxytocin.',tags:['caregiver','explorer','leader'],energy:'medium'},
    {t:'Voice Message senden',h:'2 Min pers√∂nliche Nachricht.',w:'Stimme transportiert mehr.',tags:['caregiver','creator','artist'],energy:'low'},
    {t:'Alte Freundschaft aufw√§rmen',h:'Jemand schreiben den du lange nicht sahst.',w:'Beziehungen brauchen Pflege.',tags:['caregiver','explorer','mentor'],energy:'low'},
    {t:'Smalltalk mit Fremden',h:'Kurzes Gespr√§ch: Nachbar, Kollege.',w:'Soziale √úbung.',tags:['explorer','leader','rebel'],energy:'medium'},
    {t:'Dankbarkeit senden',h:'Schreib wof√ºr du dankbar bist.',w:'St√§rkt Beziehungen.',tags:['caregiver','sage','mystic'],energy:'low'},
    {t:'Kompliment geben',h:'Ehrlich und spezifisch loben.',w:'Positive Interaktion.',tags:['caregiver','leader','mentor'],energy:'low'},
    {t:'Aktiv zuh√∂ren',h:'5 Min volle Aufmerksamkeit.',w:'Menschen f√ºhlen sich wertgesch√§tzt.',tags:['sage','caregiver','mentor','monk'],energy:'low'},
    {t:'Deep Talk f√ºhren',h:'Statt "Wie gehts?" frag "Was besch√§ftigt dich?"',w:'Tiefe Gespr√§che n√§hren.',tags:['mystic','sage','mentor','artist'],energy:'medium'},
    {t:'Gemeinsame Aktivit√§t',h:'Zusammen spazieren, kochen.',w:'Geteilte Erlebnisse verbinden.',tags:['explorer','creator','caregiver'],energy:'medium'},
    {t:'Handy weglegen',h:'Bei Gespr√§ch vollst√§ndige Pr√§senz.',w:'Ungeteilte Aufmerksamkeit ist Geschenk.',tags:['monk','caregiver','sage'],energy:'low'},
    {t:'Hilfe anbieten',h:'Konkret: "Kann ich bei X helfen?"',w:'Helfen st√§rkt Verbindung.',tags:['caregiver','warrior','leader','mentor'],energy:'medium'},
    {t:'Jemanden vorstellen',h:'Zwei Menschen verbinden.',w:'Netzwerke durch Geben st√§rken.',tags:['leader','mentor','explorer'],energy:'medium'},
    {t:'Eltern anrufen',h:'5 Min Check-in.',w:'Familienbindung ist Grundbed√ºrfnis.',tags:['caregiver','sage'],energy:'low',time:'evening'},
    {t:'Partner-Moment',h:'15 Min volle Aufmerksamkeit.',w:'Beziehungen brauchen Qualit√§tszeit.',tags:['caregiver','mystic'],energy:'low',time:'evening'},
    {t:'Feedback einholen',h:'"Wie kann ich besser sein?"',w:'Zeigt Respekt und Offenheit.',tags:['sage','leader','scientist'],energy:'medium'}
  ],
  esteem:[
    {t:'3 Erfolge aufschreiben',h:'Was hast du gut gemacht?',w:'Trainiert positive Selbstwahrnehmung.',tags:['sage','creator','mentor'],energy:'low',time:'evening'},
    {t:'5 St√§rken auflisten',h:'Worin bist du gut?',w:'Bewusstsein f√ºr eigene Ressourcen.',tags:['warrior','leader','sage'],energy:'low'},
    {t:'Positives Selbstgespr√§ch',h:'"Ich gebe mein Bestes."',w:'Innerer Dialog formt Selbstwert.',tags:['caregiver','sage','healer','stoic'],energy:'low'},
    {t:'Herausforderung annehmen',h:'Etwas tun das nerv√∂s macht.',w:'Gemeistert = bewiesen.',tags:['warrior','explorer','athlete','rebel'],energy:'high'},
    {t:'Skill 15 Min √ºben',h:'Wichtige F√§higkeit trainieren.',w:'Kompetenz = Selbstwirksamkeit.',tags:['creator','warrior','scientist','athlete'],energy:'medium'},
    {t:'Nein sagen √ºben',h:'H√∂flich aber klar ablehnen.',w:'Grenzen = Selbstachtung.',tags:['warrior','stoic','rebel','leader'],energy:'high'},
    {t:'Etwas zu Ende bringen',h:'Offene Aufgabe abschlie√üen.',w:'Completion steigert Selbstwert.',tags:['warrior','stoic','leader'],energy:'medium'},
    {t:'Eigene Meinung vertreten',h:'Position beziehen.',w:'Authentizit√§t st√§rkt Selbstwert.',tags:['rebel','leader','stoic'],energy:'high'},
    {t:'F√ºr dich einstehen',h:'Etwas ansprechen das st√∂rt.',w:'Selbstbehauptung = Selbstrespekt.',tags:['warrior','rebel','stoic'],energy:'high'},
    {t:'Komfortzone verlassen',h:'Etwas Neues ausprobieren.',w:'Wachstum passiert am Rand.',tags:['explorer','rebel','warrior'],energy:'high'},
    {t:'√ñffentlich sprechen',h:'Meinung in Meeting teilen.',w:'Sichtbarkeit baut Selbstvertrauen.',tags:['leader','rebel','mentor'],energy:'high'},
    {t:'Feedback geben',h:'Konstruktive R√ºckmeldung.',w:'Positioniert als Experte.',tags:['leader','mentor','sage'],energy:'medium'},
    {t:'Fortschritt dokumentieren',h:'Wo stehst du vs. vor 1 Jahr?',w:'Perspektive zeigt Wachstum.',tags:['sage','scientist','mentor'],energy:'low'},
    {t:'Kritik hinterfragen',h:'Ist diese Selbstkritik fair?',w:'Distanz zum inneren Kritiker.',tags:['sage','scientist','stoic'],energy:'low'},
    {t:'Schwieriges tun',h:'Was du aufschiebst, jetzt anpacken.',w:'√úberwundene Prokrastination = Stolz.',tags:['warrior','stoic','rebel'],energy:'high'}
  ],
  growth:[
    {t:'15 Min lernen',h:'Tutorial, Artikel, Podcast.',w:'Kontinuierliches Lernen.',tags:['sage','explorer','scientist','mentor'],energy:'medium'},
    {t:'Buch lesen (20 Min)',h:'Sachbuch oder anspruchsvolle Literatur.',w:'B√ºcher komprimieren Weisheit.',tags:['sage','scientist','mystic'],energy:'low',time:'evening'},
    {t:'Online-Kurs Lektion',h:'Eine Lektion absolvieren.',w:'Strukturiertes Lernen.',tags:['scientist','sage','creator'],energy:'medium'},
    {t:'Kreativ sein (15 Min)',h:'Zeichnen, schreiben ohne Ziel.',w:'Aktiviert Flow.',tags:['creator','explorer','artist','mystic'],energy:'medium'},
    {t:'Morning Pages',h:'3 Seiten Bewusstseinsstrom.',w:'Kl√§rt den Geist.',tags:['creator','artist','sage','mystic'],energy:'low',time:'morning'},
    {t:'Ideen brainstormen',h:'10 Ideen zu einem Thema.',w:'Ideen-Muskel trainieren.',tags:['creator','scientist','rebel','explorer'],energy:'medium'},
    {t:'Journal schreiben',h:'5-10 Min √ºber Tag reflektieren.',w:'Verarbeitung und Selbsterkenntnis.',tags:['sage','mystic','scientist','stoic'],energy:'low',time:'evening'},
    {t:'Zukunftsvision schreiben',h:'Ideales Leben in 5 Jahren.',w:'Klare Vision = Richtung.',tags:['leader','creator','mystic'],energy:'medium'},
    {t:'Fehler analysieren',h:'Was kannst du lernen?',w:'Fehler = Daten.',tags:['sage','warrior','scientist','stoic'],energy:'medium'},
    {t:'Werte definieren',h:'Top 3 Werte?',w:'Werte geben Klarheit.',tags:['sage','stoic','mystic','leader'],energy:'low'},
    {t:'Neuen Weg nehmen',h:'Andere Route.',w:'Neue Eindr√ºcke stimulieren.',tags:['explorer','creator','rebel'],energy:'low'},
    {t:'Fremde Perspektive',h:'Thema aus anderer Sicht.',w:'Flexibilit√§t trainieren.',tags:['sage','scientist','mystic'],energy:'medium'},
    {t:'Deep Work Session',h:'90 Min fokussierte Arbeit.',w:'Tiefe = wahre Produktivit√§t.',tags:['scientist','creator','sage','leader'],energy:'high'},
    {t:'Schwieriges Thema angehen',h:'Etwas lernen das einsch√ºchtert.',w:'An der Grenze w√§chst man.',tags:['scientist','sage','warrior','explorer'],energy:'high'},
    {t:'Etwas bauen/reparieren',h:'Hands-on Projekt.',w:'Making ist erf√ºllend.',tags:['creator','scientist','explorer'],energy:'medium'},
    {t:'Podcast h√∂ren',h:'Bildend, nicht nur unterhaltend.',w:'Nutze "tote Zeit".',tags:['sage','explorer','scientist'],energy:'low'}
  ],
  transcend:[
    {t:'Jemandem konkret helfen',h:'Aktiv Hilfe anbieten.',w:'Aktiviert Belohnungssystem.',tags:['caregiver','warrior','leader','mentor'],energy:'medium'},
    {t:'Wissen teilen',h:'Jemandem etwas erkl√§ren.',w:'Teilen verst√§rkt Verstehen.',tags:['sage','mentor','leader','scientist'],energy:'medium'},
    {t:'Mentoring anbieten',h:'J√ºngere unterst√ºtzen.',w:'Verm√§chtnis beginnt mit Gespr√§ch.',tags:['mentor','sage','leader'],energy:'medium'},
    {t:'Spenden',h:'Geld oder Ressourcen.',w:'Finanzieller Beitrag.',tags:['caregiver','leader','sage'],energy:'low'},
    {t:'Zeit schenken',h:'Stunde ohne Gegenleistung.',w:'Zeit ist wertvollste Ressource.',tags:['caregiver','mentor','sage'],energy:'medium'},
    {t:'Inspiration teilen',h:'Motivierenden Gedanken weitergeben.',w:'Positive Energie verst√§rkt sich.',tags:['leader','creator','mentor','mystic'],energy:'low'},
    {t:'M√ºll aufsammeln',h:'5 Dinge auf dem Weg.',w:'Kleine Taten f√ºr Gemeinschaft.',tags:['explorer','caregiver','warrior'],energy:'low'},
    {t:'Umweltfreundliche Entscheidung',h:'Plastik vermeiden, Rad fahren.',w:'Verbindung mit Gr√∂√üerem.',tags:['explorer','caregiver','sage'],energy:'low'},
    {t:'Legacy-Gedanken',h:'Was m√∂chtest du hinterlassen?',w:'√úber Leben hinausdenken.',tags:['sage','leader','mystic','mentor'],energy:'low',time:'evening'},
    {t:'Dankbarkeitsbrief',h:'L√§ngeren Brief an pr√§gende Person.',w:'Tiefe Dankbarkeit transformiert.',tags:['sage','caregiver','mystic'],energy:'medium'},
    {t:'Purpose reflektieren',h:'Wozu bist du hier?',w:'Sinnfragen ordnen Priorit√§ten.',tags:['mystic','sage','leader'],energy:'medium'},
    {t:'Meditation (10 Min)',h:'Stille sitzen, Atem beobachten.',w:'Verbindung mit tieferer Ebene.',tags:['monk','mystic','sage','healer','stoic'],energy:'low'},
    {t:'Dankbarkeits-Meditation',h:'3 Dinge durchgehen.',w:'Dankbarkeit = F√ºlle.',tags:['mystic','healer','sage'],energy:'low',time:'evening'},
    {t:'In Natur sein',h:'Zeit in Parks, W√§ldern.',w:'Naturverbundenheit heilt.',tags:['explorer','mystic','healer'],energy:'low'},
    {t:'Sternenhimmel betrachten',h:'5 Min Nachthimmel ansehen.',w:'Teil von etwas Gr√∂√üerem.',tags:['mystic','explorer','sage'],energy:'low',time:'night'},
    {t:'Positive Review schreiben',h:'F√ºr Service/Produkt das half.',w:'Feedback hilft anderen.',tags:['caregiver','mentor','leader'],energy:'low'}
  ]
};

const MOOD_LABELS=['','Sehr schlecht','Schlecht','Neutral','Gut','Sehr gut'];
const GOOD_CHIPS=[{k:'sleep',e:'üò¥',t:'Gut geschlafen'},{k:'move',e:'üèÉ',t:'Bewegt'},{k:'walk',e:'üö∂',t:'Spaziert'},{k:'eat',e:'ü•ó',t:'Gesund gegessen'},{k:'water',e:'üíß',t:'Getrunken'},{k:'stretch',e:'üßò',t:'Gedehnt'},{k:'meditate',e:'üß†',t:'Meditiert'},{k:'nature',e:'üå≥',t:'In Natur'},{k:'social',e:'üë•',t:'Sozial'},{k:'creative',e:'üé®',t:'Kreativ'}];
const BAD_CHIPS=[{k:'badsleep',e:'üò´',t:'Schlecht geschlafen'},{k:'junk',e:'üçü',t:'Junk Food'},{k:'lazy',e:'üõãÔ∏è',t:'Wenig bewegt'},{k:'dehydrate',e:'üèúÔ∏è',t:'Wenig getrunken'},{k:'chaos',e:'üì¶',t:'Chaos'},{k:'overwhelm',e:'üåä',t:'√úberw√§ltigt'},{k:'lonely',e:'üòî',t:'Einsam'},{k:'procrastinate',e:'‚è∞',t:'Aufgeschoben'},{k:'scroll',e:'üì±',t:'Zu viel Handy'},{k:'negative',e:'üí≠',t:'Negative Gedanken'}];
const COACH_MSGS={balanced:'Deine Balance ist stark!',foundation_low:'Basis st√§rken. K√∂rper zuerst.',safety_low:'Zeit f√ºr Ordnung.',connect_low:'Menschen brauchen Menschen.',esteem_low:'St√§rke dein Selbstbild.',growth_low:'Zeit zum Wachsen!',transcend_low:'Wie kannst du beitragen?'};

// STATE
const defaults={bio:{sleepH:7,sleepQ:3,steps:5000,trainMin:0},mental:{locus:50,intention:50,efficacy:50,narrative:50}};
let state={arch:'warrior',streak:0,actions:[],genTier:0,lastDate:null,mood:0,good:{},bad:{},dayLog:[],bio:{...defaults.bio},mental:{...defaults.mental},currentAction:null};

function load(){try{const s=localStorage.getItem('humaneed3');if(s){const d=JSON.parse(s);state={...state,...d};state.bio={...defaults.bio,...(d.bio||{})};state.mental={...defaults.mental,...(d.mental||{})};}}catch(e){}checkDayReset();}
function save(){localStorage.setItem('humaneed3',JSON.stringify(state));}
function checkDayReset(){const today=new Date().toDateString();if(state.lastDate&&state.lastDate!==today){state.dayLog.unshift({date:state.lastDate,mood:state.mood,good:{...state.good},bad:{...state.bad},bio:{...state.bio},mental:{...state.mental}});if(state.dayLog.length>30)state.dayLog.pop();state.good={};state.bad={};state.mood=0;state.bio={...defaults.bio};state.mental={...defaults.mental};}state.lastDate=today;save();}
function toast(m){const t=$('#toast');t.textContent=m;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2000);}
function clamp(v,min,max){return Math.max(min,Math.min(max,v));}

// SCORING mit Mental-Multiplikator
function subFoundation(){const{sleepH,sleepQ,steps,trainMin}=state.bio;let s=(sleepH/8)*30+(sleepQ/5)*20+(steps/8000)*30+(trainMin/30)*20;if(state.good.sleep)s+=10;if(state.good.move)s+=8;if(state.good.walk)s+=6;if(state.good.water)s+=5;if(state.bad.badsleep)s-=15;if(state.bad.lazy)s-=10;if(state.bad.junk)s-=8;if(state.bad.dehydrate)s-=6;return clamp(s,0,120);}
function subSafety(){let s=50;if(state.good.eat)s+=10;if(state.bad.chaos)s-=15;if(state.bad.overwhelm)s-=10;if(state.bad.procrastinate)s-=8;s+=(state.mental.locus-50)*0.2;return clamp(s,0,120);}
function subConnect(){let s=50;if(state.good.social)s+=15;if(state.bad.lonely)s-=15;if(state.bad.overwhelm)s-=8;s+=(state.mental.narrative-50)*0.15;return clamp(s,0,120);}
function subEsteem(){let s=50;if(state.good.creative)s+=10;if(state.bad.negative)s-=12;if(state.bad.overwhelm)s-=10;s+=(state.mental.efficacy-50)*0.3;s+=(state.mental.intention-50)*0.2;return clamp(s,0,120);}
function subGrowth(){let s=50;if(state.good.meditate)s+=8;if(state.good.stretch)s+=6;if(state.bad.scroll)s-=10;s+=(state.mental.intention-50)*0.25;s+=(state.mental.locus-50)*0.15;return clamp(s,0,120);}
function subTranscend(){let s=50;if(state.good.nature)s+=8;s+=(state.mental.narrative-50)*0.2;s+=(state.mental.efficacy-50)*0.15;return clamp(s,0,120);}
function getMentalMult(){return 0.8+((state.mental.locus+state.mental.efficacy)/200)*0.4;}

function getScores(){
  const subs=[subFoundation(),subSafety(),subConnect(),subEsteem(),subGrowth(),subTranscend()];
  const moodMod={1:-8,2:-4,3:0,4:4,5:8}[state.mood]||0;
  const mm=getMentalMult();
  const now=new Date();
  const actBonus=[0,0,0,0,0,0];
  state.actions?.forEach(a=>{const age=(now-new Date(a.date))/(1000*60*60*24);if(age<=7)actBonus[a.tier]+=8*(1-age/14);});
  return subs.map((v,i)=>Math.round(clamp((v+actBonus[i]+moodMod)*mm/6,0,20)));
}

// WHEEL
function renderWheel(){
  const svg=$('#wheelSvg'),cx=150,cy=150,r=95,scores=getScores(),total=scores.reduce((a,b)=>a+b,0);
  let h='';
  TIERS.forEach((t,i)=>{
    const a=(i*60-90)*Math.PI/180,sc=scores[i]/20,nr=22+sc*12,x=cx+r*Math.cos(a),y=cy+r*Math.sin(a);
    h+=`<g class="wn" data-t="${i}" style="cursor:pointer">`;
    h+=`<circle cx="${x}" cy="${y}" r="${nr}" fill="rgba(15,15,25,.95)" stroke="${t.c}" stroke-width="${1.5+sc}"/>`;
    if(sc>0){const circ=2*Math.PI*nr,dash=circ*sc;h+=`<circle cx="${x}" cy="${y}" r="${nr}" fill="none" stroke="${t.c}" stroke-width="2.5" stroke-dasharray="${dash} ${circ-dash}" transform="rotate(-90 ${x} ${y})" stroke-linecap="round"/>`;}
    h+=`<text x="${x}" y="${y-2}" text-anchor="middle" font-size="${10+sc*4}">${t.e}</text>`;
    h+=`<text x="${x}" y="${y+10}" text-anchor="middle" font-size="10" fill="${t.c}" font-weight="700">${scores[i]}</text></g>`;
  });
  svg.innerHTML=h;
  svg.querySelectorAll('.wn').forEach(n=>n.onclick=()=>showImpulse(+n.dataset.t));
  $('#centerScore').textContent=total;if($('#statScore'))$('#statScore').textContent=total;
  renderBreakdown();
}

function renderBreakdown(){
  const scores=getScores();
  $('#breakdown').innerHTML=TIERS.map((t,i)=>`<div class="bd-row"><div class="bd-icon">${t.e}</div><div class="bd-name">${t.n}</div><div class="bd-bar"><div class="bd-fill" style="width:${scores[i]*5}%;background:${t.c}"></div></div><div class="bd-val">${scores[i]}</div></div>`).join('');
}

// SMART
function getSmartTier(){
  const scores=getScores();
  const weights=[1.5,1.3,1.0,1.0,0.8,0.6]; // Maslow: Basis wichtiger
  const weighted=scores.map((s,i)=>({tier:i,priority:(20-s)*weights[i]}));
  weighted.sort((a,b)=>b.priority-a.priority);
  return weighted[0].tier;
}

function getActionForTier(tier,skip=false){
  const pool=ACTIONS[TIERS[tier].k]||[];
  const arch=state.arch;
  const recent=state.actions.slice(0,5).map(a=>a.text);
  const hour=new Date().getHours();
  
  // Score each action
  const scored=pool.map(a=>{
    let score=1;
    // Archetyp-Bonus
    if(a.tags?.includes(arch)||a.tags?.includes('all'))score*=1.5;
    // Recency-Penalty
    if(recent.includes(a.t))score*=0.1;
    // Skip current
    if(skip&&state.currentAction&&a.t===state.currentAction.t)score*=0;
    // Time-of-day bonus
    if(a.time==='morning'&&hour>=5&&hour<10)score*=1.3;
    if(a.time==='evening'&&hour>=18&&hour<23)score*=1.3;
    if(a.time==='night'&&(hour>=22||hour<6))score*=1.2;
    // Energy-based
    if(a.energy==='low'&&state.mental.efficacy<40)score*=1.4;
    if(a.energy==='high'&&state.mental.efficacy>60)score*=1.3;
    return{a,score};
  }).filter(x=>x.score>0);
  
  // Weighted random selection
  const total=scored.reduce((sum,x)=>sum+x.score,0);
  let r=Math.random()*total;
  for(const x of scored){r-=x.score;if(r<=0)return x.a;}
  return pool[0];
}

function renderRec(){
  const tier=getSmartTier(),act=getActionForTier(tier);
  state.currentAction={...act,tier};
  const t=TIERS[tier],a=ARCHETYPES[state.arch];
  $('#recIcon').textContent=t.e;
  $('#recWhy').textContent=`${t.n} st√§rken ¬∑ ${a.tone.anrede}`;
  $('#recTask').textContent=act.t;
}

$('#recSkip').onclick=()=>{renderRec();toast('Andere Empfehlung');};
$('#recDo').onclick=()=>{state.genTier=getSmartTier();switchView('action');renderTierRow();renderGen();};

function renderCoach(){
  const s=getScores(),minIdx=s.indexOf(Math.min(...s)),arch=ARCHETYPES[state.arch],tier=TIERS[minIdx];
  let msg=Math.min(...s)>12?COACH_MSGS.balanced:COACH_MSGS[tier.k+'_low']||COACH_MSGS.balanced;
  $('#coachTitle').textContent=`üí¨ ${arch.tone.anrede} ¬∑ ${tier.n}`;
  $('#coachMsg').innerHTML=`<strong>${arch.n}:</strong> ${arch.tone.motiv}<br><br>${msg}`;
}

function showImpulse(tier){
  const act=getActionForTier(tier),t=TIERS[tier];
  $('#impulseBox').innerHTML=`<div class="impulse"><div class="impulse-head"><div class="impulse-icon">${t.e}</div><div class="impulse-tier" style="color:${t.c}">${t.n}</div><button class="impulse-x" onclick="$('#impulseBox').innerHTML=''">√ó</button></div><div class="impulse-task">${act.t}</div><div class="impulse-detail"><div class="impulse-row"><b>Wie:</b> ${act.h}</div><div class="impulse-row"><b>Warum:</b> ${act.w}</div></div><div class="impulse-btns"><button class="btn" onclick="showImpulse(${tier})">Andere</button><button class="btn primary" onclick="completeAction(${tier},'${act.t.replace(/'/g,"\\'")}');$('#impulseBox').innerHTML=''">‚úì Done</button></div></div>`;
}

const STREAK_MILESTONES={3:'üî• 3-Tage-Streak!',7:'üí™ Wochenkrieger!',14:'‚≠ê 2 Wochen stark!',30:'üèÜ Monatsheld!',50:'üëë 50 Tage Legende!',100:'üåü 100 Tage Meister!'};

function completeAction(tier,text){
  state.actions.unshift({tier,text,date:new Date().toISOString()});
  if(state.actions.length>100)state.actions.pop();
  state.streak=(state.streak||0)+1;
  
  // Streak milestone check
  const milestone=STREAK_MILESTONES[state.streak];
  
  save();renderWheel();renderRec();renderCoach();updateHeader();renderHist();
  
  if(milestone){toast(milestone);}else{toast('‚úì Erledigt! +1');}
}

// GENERATOR
function renderTierRow(){
  $('#tierRow').innerHTML=TIERS.map((t,i)=>`<button class="tier-btn${i===state.genTier?' on':''}" style="--c:${t.c}" data-t="${i}">${t.e}</button>`).join('');
  $$('.tier-btn').forEach(b=>b.onclick=function(){state.genTier=+this.dataset.t;renderTierRow();renderGen();});
}

function renderGen(){
  const tier=state.genTier,act=getActionForTier(tier,true),t=TIERS[tier];
  state.currentAction={...act,tier};
  $('#genTier').innerHTML=`${t.e} ${t.n}`;$('#genTier').style.color=t.c;
  $('#genTask').textContent=act.t;
  $('#genDetail').innerHTML=`<div class="gen-row"><b>Wie:</b> ${act.h}</div><div class="gen-row"><b>Warum:</b> ${act.w}</div>`;
}

$('#genSkip').onclick=()=>renderGen();
$('#genDone').onclick=()=>{if(state.currentAction){completeAction(state.genTier,state.currentAction.t);renderGen();}};

function renderHist(){
  const el=$('#histList');
  if(!state.actions?.length){el.innerHTML='<div class="empty">Noch keine Aktionen</div>';return;}
  el.innerHTML=state.actions.slice(0,10).map(a=>{const t=TIERS[a.tier],d=new Date(a.date).toLocaleDateString('de-DE',{day:'numeric',month:'short'});return`<div class="hist">${t.e} <strong>${a.text}</strong> ¬∑ ${d}</div>`;}).join('');
}

// CHECK-IN
function renderMood(){
  $$('.mood-btn').forEach(b=>{b.classList.toggle('on',+b.dataset.m===state.mood);b.onclick=()=>{state.mood=+b.dataset.m;save();renderMood();renderWheel();};});
  $('#moodLabel').textContent=MOOD_LABELS[state.mood]||'';
}

function renderChips(){
  $('#goodChips').innerHTML=GOOD_CHIPS.map(c=>`<div class="chip${state.good[c.k]?' on':''}" data-k="${c.k}">${c.e} ${c.t}</div>`).join('');
  $('#badChips').innerHTML=BAD_CHIPS.map(c=>`<div class="chip bad${state.bad[c.k]?' on':''}" data-k="${c.k}">${c.e} ${c.t}</div>`).join('');
  $$('#goodChips .chip').forEach(c=>c.onclick=()=>{state.good[c.dataset.k]=!state.good[c.dataset.k];save();renderChips();renderWheel();});
  $$('#badChips .chip').forEach(c=>c.onclick=()=>{state.bad[c.dataset.k]=!state.bad[c.dataset.k];save();renderChips();renderWheel();});
}

function renderBioInputs(){
  const b=state.bio;
  $('#bioSleep').value=b.sleepH;$('#bioSleepVal').textContent=b.sleepH+'h';
  $('#bioQual').value=b.sleepQ;$('#bioQualVal').textContent=b.sleepQ;
  $('#bioSteps').value=b.steps;$('#bioStepsVal').textContent=(b.steps/1000).toFixed(1)+'k';
  $('#bioTrain').value=b.trainMin;$('#bioTrainVal').textContent=b.trainMin+'m';
}
$('#bioSleep').oninput=function(){state.bio.sleepH=+this.value;$('#bioSleepVal').textContent=this.value+'h';save();renderWheel();};
$('#bioQual').oninput=function(){state.bio.sleepQ=+this.value;$('#bioQualVal').textContent=this.value;save();renderWheel();};
$('#bioSteps').oninput=function(){state.bio.steps=+this.value;$('#bioStepsVal').textContent=(this.value/1000).toFixed(1)+'k';save();renderWheel();};
$('#bioTrain').oninput=function(){state.bio.trainMin=+this.value;$('#bioTrainVal').textContent=this.value+'m';save();renderWheel();};

function renderMentalInputs(){
  const m=state.mental;
  $('#menLocus').value=m.locus;$('#menLocusVal').textContent=m.locus;
  $('#menIntent').value=m.intention;$('#menIntentVal').textContent=m.intention;
  $('#menEffic').value=m.efficacy;$('#menEfficVal').textContent=m.efficacy;
  $('#menNarr').value=m.narrative;$('#menNarrVal').textContent=m.narrative;
}
$('#menLocus').oninput=function(){state.mental.locus=+this.value;$('#menLocusVal').textContent=this.value;save();renderWheel();};
$('#menIntent').oninput=function(){state.mental.intention=+this.value;$('#menIntentVal').textContent=this.value;save();renderWheel();};
$('#menEffic').oninput=function(){state.mental.efficacy=+this.value;$('#menEfficVal').textContent=this.value;save();renderWheel();};
$('#menNarr').oninput=function(){state.mental.narrative=+this.value;$('#menNarrVal').textContent=this.value;save();renderWheel();};

// PROFILE
function renderArchGrid(){
  const keys=Object.keys(ARCHETYPES);
  $('#archGrid').innerHTML=keys.map(k=>{const a=ARCHETYPES[k];return`<div class="arch${state.arch===k?' on':''}" data-k="${k}"><div class="arch-e">${a.e}</div><div class="arch-n">${a.n}</div><div class="arch-d">${a.d}</div></div>`;}).join('');
  $$('#archGrid .arch').forEach(el=>el.onclick=()=>{state.arch=el.dataset.k;save();renderArchGrid();renderArchDetail();updateHeader();renderRec();renderCoach();toast(ARCHETYPES[state.arch].n+' gew√§hlt');});
}

function renderArchDetail(){
  const a=ARCHETYPES[state.arch];if(!a)return;
  $('#archDetail').innerHTML=`<div class="card arch-detail"><div class="arch-head"><div class="arch-big">${a.e}</div><div class="arch-info"><h3>${a.n}</h3><p>${a.d}</p></div></div><div style="font-size:13px;color:var(--sub);line-height:1.6;margin-bottom:12px"><em>"${a.philosophy}"</em></div><div class="traits">${a.traits.map(t=>`<span class="trait">${t}</span>`).join('')}</div>${a.icons?`<div style="margin-top:14px;font-size:11px;color:var(--muted)">Vorbilder: ${a.icons.join(', ')}</div>`:''}</div>`;
}

function updateHeader(){const a=ARCHETYPES[state.arch];$('#archPill').textContent=a?.e||'‚öîÔ∏è';$('#streakVal').textContent=state.streak||0;setAccentColor();}

function setAccentColor(){
  const a=ARCHETYPES[state.arch];
  if(!a)return;
  const c=a.color;
  const root=document.documentElement;
  root.style.setProperty('--accent',c);
  root.style.setProperty('--accent-soft',c+'1a');
  root.style.setProperty('--accent-glow',c+'40');
}

$('#archPill').onclick=()=>{$('#modal').classList.add('on');renderModalArch();};
$('#modalClose').onclick=()=>$('#modal').classList.remove('on');
$('#modal').onclick=e=>{if(e.target===$('#modal'))$('#modal').classList.remove('on');};

function renderModalArch(){
  const keys=Object.keys(ARCHETYPES);
  $('#modalArchGrid').innerHTML=keys.map(k=>{const a=ARCHETYPES[k];return`<div class="arch${state.arch===k?' on':''}" data-k="${k}"><div class="arch-e">${a.e}</div><div class="arch-n">${a.n}</div></div>`;}).join('');
  $$('#modalArchGrid .arch').forEach(el=>el.onclick=()=>{state.arch=el.dataset.k;save();renderArchGrid();renderArchDetail();updateHeader();renderRec();renderCoach();renderModalArch();toast(ARCHETYPES[state.arch].n+' gew√§hlt');});
}

function renderStats(){$('#statStreak').textContent=state.streak||0;$('#statActions').textContent=state.actions?.length||0;}

function renderInsights(){
  const s=getScores(),total=s.reduce((a,b)=>a+b,0),minT=TIERS[s.indexOf(Math.min(...s))],maxT=TIERS[s.indexOf(Math.max(...s))];
  $('#insights').innerHTML=`<div class="insight">Gesamtscore: <strong>${total}/120</strong></div><div class="insight">St√§rkste Ebene: <strong>${maxT.e} ${maxT.n}</strong></div><div class="insight">Fokus n√∂tig: <strong>${minT.e} ${minT.n}</strong></div>`;
}

// NAV
function switchView(v){$$('nav button').forEach(x=>x.classList.toggle('on',x.dataset.v===v));$$('.view').forEach(x=>x.classList.toggle('on',x.id==='v-'+v));}
$$('nav button').forEach(b=>b.onclick=function(){
  switchView(this.dataset.v);
  if(this.dataset.v==='action'){state.genTier=getSmartTier();renderTierRow();renderGen();renderHist();}
  if(this.dataset.v==='checkin'){renderBioInputs();renderMentalInputs();}
  if(this.dataset.v==='profile'){renderInsights();renderStats();}
});

$$('.tab').forEach(t=>t.onclick=function(){
  $$('.tab').forEach(x=>x.classList.remove('on'));this.classList.add('on');
  $$('.sub').forEach(s=>{s.style.display='none';s.classList.remove('on');});
  const sub=$(`#sub-${this.dataset.t}`);sub.style.display='block';sub.classList.add('on');
  if(this.dataset.t==='journal'){renderInsights();renderStats();}
});

// INIT
load();
setAccentColor();
renderWheel();renderRec();renderCoach();
renderTierRow();renderGen();renderHist();
renderMood();renderChips();renderBioInputs();renderMentalInputs();
renderArchGrid();renderArchDetail();updateHeader();
renderStats();
</script>
</body>
</html>
